import{g as c,a as d,i as f}from"./request-Bnfiq4FI.js";import{_ as u}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as t,o as i,f as n,a as o,t as m}from"./app-DQop-ceN.js";const _={name:"GamePlayer",data(){return{imageBaseUrl:f,gameBaseUrl:d,gameId:null,gameInfo:null,loading:!1,error:null,showGameFrame:!1,gameStarting:!1,gameUrl:""}},mounted(){this.initGame()},methods:{initGame(){const a=new URLSearchParams(window.location.search);this.gameId=a.get("id"),this.gameId&&this.loadGameInfo()},async loadGameInfo(){this.loading=!0,this.error=null;try{const a=await c.getGames();if(a.success){const s=a.data.find(g=>g.folder_name===this.gameId);s?this.gameInfo=s:this.error="未找到指定的游戏"}else this.error=`获取游戏信息失败: ${a.error}`}catch(a){this.error=a.message}finally{this.loading=!1}},async startGame(){if(this.gameInfo.is_online_playable){this.gameStarting=!0;try{this.gameUrl=`${d}/${this.gameId}/index.html`,this.showGameFrame=!0}catch(a){this.error=`启动游戏失败: ${a.message}`}finally{this.gameStarting=!1}}},stopGame(){this.showGameFrame=!1,this.gameUrl=""},downloadGame(){const a=c.getDownloadUrl(this.gameId);window.open(a,"_blank")},goToGameList(){window.location.href="/game/list.html"},formatDate(a){return new Date(a).toLocaleString("zh-CN")}}},h={class:"game-player-container"},v={key:0,class:"loading"},I={key:1,class:"error-message"},p={key:2,class:"no-game-selected"},y={key:3,class:"game-container"},G={class:"game-header"},b={class:"game-info"},k={class:"game-meta"},w={class:"author"},U={class:"version"},B={class:"upload-time"},C={key:0,class:"description"},S={key:0,class:"game-cover"},L=["src","alt"],D={class:"game-controls"},F=["disabled"],T={key:0,class:"game-frame-container"},x={class:"game-frame-header"},P=["src"],N={key:1,class:"offline-notice"};function z(a,s,g,V,e,r){return i(),t("div",h,[e.loading?(i(),t("div",v,[...s[6]||(s[6]=[o("p",null,"正在加载游戏...",-1)])])):n("v-if",!0),e.error?(i(),t("div",I,[s[7]||(s[7]=o("h2",null,"加载失败",-1)),o("p",null,m(e.error),1),o("button",{onClick:s[0]||(s[0]=l=>a.$router.go(-1)),class:"back-btn"},"返回游戏列表")])):n("v-if",!0),!e.loading&&!e.error&&!e.gameId?(i(),t("div",p,[s[8]||(s[8]=o("h2",null,"未选择游戏",-1)),s[9]||(s[9]=o("p",null,"请从游戏列表中选择一个游戏进行游玩。",-1)),o("button",{onClick:s[1]||(s[1]=(...l)=>r.goToGameList&&r.goToGameList(...l)),class:"back-btn"},"前往游戏列表")])):n("v-if",!0),e.gameInfo&&!e.loading&&!e.error?(i(),t("div",y,[n(" 游戏信息 "),o("div",G,[o("div",b,[o("h1",null,m(e.gameInfo.game_name),1),o("div",k,[o("span",w,"作者: "+m(e.gameInfo.author),1),o("span",U,"版本: "+m(e.gameInfo.version),1),o("span",B,"上传时间: "+m(r.formatDate(e.gameInfo.upload_time)),1)]),e.gameInfo.description?(i(),t("p",C,m(e.gameInfo.description),1)):n("v-if",!0)]),e.gameInfo.cover_image?(i(),t("div",S,[o("img",{src:`${e.imageBaseUrl}/${e.gameInfo.cover_image}`,alt:`${e.gameInfo.game_name} 封面`,class:"cover-image"},null,8,L)])):n("v-if",!0)]),n(" 游戏控制按钮 "),o("div",D,[o("button",{onClick:s[2]||(s[2]=(...l)=>r.goToGameList&&r.goToGameList(...l)),class:"control-btn secondary"},"返回列表"),e.gameInfo.is_online_playable?(i(),t("button",{key:0,onClick:s[3]||(s[3]=(...l)=>r.startGame&&r.startGame(...l)),disabled:e.gameStarting,class:"control-btn primary"},m(e.gameStarting?"加载中...":"开始游戏"),9,F)):(i(),t("button",{key:1,onClick:s[4]||(s[4]=(...l)=>r.downloadGame&&r.downloadGame(...l)),class:"control-btn primary"}," 下载游戏 "))]),n(" 游戏播放区域 "),e.showGameFrame&&e.gameInfo.is_online_playable?(i(),t("div",T,[o("div",x,[o("span",null,m(e.gameInfo.game_name),1),o("button",{onClick:s[5]||(s[5]=(...l)=>r.stopGame&&r.stopGame(...l)),class:"close-game-btn"},"×")]),o("iframe",{src:e.gameUrl,class:"game-frame",frameborder:"0",allowfullscreen:""},null,8,P)])):n("v-if",!0),n(" 不支持在线游玩的提示 "),e.gameInfo.is_online_playable?n("v-if",!0):(i(),t("div",N,[s[10]||(s[10]=o("h3",null,"此游戏不支持在线游玩",-1)),o("p",null,"请下载游戏文件到本地运行。游戏文件大小: "+m((e.gameInfo.file_size/1024/1024).toFixed(2))+" MB",1)]))])):n("v-if",!0)])}const R=u(_,[["render",z],["__scopeId","data-v-94bba8c6"]]);export{R as default};

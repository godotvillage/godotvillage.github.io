import{b as u}from"./request-7grEb9by.js";import{_ as m,c as n,o as r,d as o,f as l,F as h,g as f,h as y,t as d}from"./app-D6PJ4VnR.js";const p={data(){return{discussions:[],categories:[],selectedCategoryId:null,loading:!0,loadingMore:!1,hasNextPage:!1,currentPage:1,pageSize:10,endCursor:null,categoriesSort:["公告","日常","求助","分享与讨论","想法","投票","水区","WEB"],disabeledCategories:["WEB"]}},async mounted(){await this.fetchCategories(),await this.fetchDiscussions()},methods:{async fetchCategories(){try{const e=await(await fetch(u+"/discussion/categories")).json();if(e.success)this.categories=e.data.categories.sort((a,g)=>this.categoriesSort.indexOf(a.name)-this.categoriesSort.indexOf(g.name)),this.selectedCategoryId=e.data.defaultCategoryId;else throw new Error(e.error)}catch(s){console.error("获取分类列表失败:",s)}},async fetchDiscussions(s=!1){try{s?this.loadingMore=!0:(this.loading=!0,this.discussions=[],this.currentPage=1,this.endCursor=null);let e=u+"/discussion/list";const a=new URLSearchParams;this.selectedCategoryId&&a.append("categoryId",this.selectedCategoryId),s&&this.endCursor&&a.append("after",this.endCursor),a.append("pageSize",this.pageSize),a.toString()&&(e+="?"+a.toString());const i=await(await fetch(e)).json();if(i.success)s?this.discussions=[...this.discussions,...i.data]:this.discussions=i.data,i.pagination&&(this.hasNextPage=i.pagination.hasNextPage,this.endCursor=i.pagination.pageInfo.endCursor);else throw new Error(i.error)}catch(e){console.error("获取讨论列表失败:",e)}finally{this.loading=!1,this.loadingMore=!1}},async selectCategory(s){this.selectedCategoryId!==s&&(this.selectedCategoryId=s,await this.fetchDiscussions())},handleScroll(s){const{scrollTop:e,scrollHeight:a,clientHeight:g}=s.target;e+g>=a-100&&this.hasNextPage&&!this.loadingMore&&!this.loading&&(this.currentPage++,this.fetchDiscussions(!0))},getCategoryEmoji(s){const e=this.categories.find(a=>a.id===s);return e?e.emojiHTML:""},navigateToDiscussion(s){this.$router.push(`/discussion/index.html?number=${s.number}&category=${encodeURIComponent(JSON.stringify(s.category))}`)},createNewDiscussion(){let s=this.categories.find(e=>e.id===this.selectedCategoryId).name;window.open(`https://github.com/godotvillage/godotvillage.github.io/discussions/new?category=${s}`,"_blank")},formatDate(s){return new Date(s).toLocaleDateString("zh-CN")}}},C={class:"discussions-list"},v={class:"forum-header"},w={class:"category-selector"},k={class:"category-tabs"},S=["onClick"],D=["innerHTML"],b={class:"category-name"},N={key:0,class:"loading"},I={key:1,class:"loading"},x=["onClick"],L={class:"discussion-header"},M=["innerHTML"],P={class:"discussion-title"},T={class:"discussion-meta"},j={class:"author"},H={class:"date"},E={class:"comments"},z={key:0,class:"category"},B={key:2,class:"loading-more"},O={key:3,class:"no-more"};function U(s,e,a,g,i,c){return r(),n("div",C,[o("div",v,[e[2]||(e[2]=o("h2",null,"论坛列表",-1)),o("button",{onClick:e[0]||(e[0]=(...t)=>c.createNewDiscussion&&c.createNewDiscussion(...t)),class:"new-post-btn"},"新建帖子")]),l(" 分类选择器 "),o("div",w,[o("div",k,[(r(!0),n(h,null,f(i.categories,t=>(r(),n(h,{key:t.id},[i.disabeledCategories.includes(t.name)?l("v-if",!0):(r(),n("div",{key:0,class:y(["category-tab",{active:i.selectedCategoryId===t.id}]),onClick:_=>c.selectCategory(t.id)},[o("span",{innerHTML:t.emojiHTML,class:"category-emoji"},null,8,D),o("span",b,d(t.name),1)],10,S))],64))),128))])]),o("div",{class:"discussions-container",onScroll:e[1]||(e[1]=(...t)=>c.handleScroll&&c.handleScroll(...t)),ref:"container"},[i.loading&&i.discussions.length===0?(r(),n("div",N,"加载中...")):l("v-if",!0),!i.loading&&i.discussions.length===0?(r(),n("div",I,"没有找到讨论")):l("v-if",!0),(r(!0),n(h,null,f(i.discussions,t=>(r(),n("div",{key:t.id,class:"discussion-item",onClick:_=>c.navigateToDiscussion(t)},[o("div",L,[t.category?(r(),n("span",{key:0,innerHTML:c.getCategoryEmoji(t.category.id),class:"discussion-category-emoji"},null,8,M)):l("v-if",!0),o("div",P,d(t.title),1)]),o("div",T,[o("span",j,"作者: "+d(t.author.login),1),o("span",H,d(c.formatDate(t.createdAt)),1),o("span",E,"评论: "+d(t.comments.totalCount),1),t.category?(r(),n("span",z,"分类: "+d(t.category.name),1)):l("v-if",!0)])],8,x))),128)),i.loadingMore?(r(),n("div",B,"加载更多...")):l("v-if",!0),!i.hasNextPage&&i.discussions.length>0?(r(),n("div",O,"没有更多内容了")):l("v-if",!0)],544)])}const V=m(p,[["render",U],["__scopeId","data-v-8f8186a6"]]);export{V as default};

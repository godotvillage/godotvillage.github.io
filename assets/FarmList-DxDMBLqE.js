import{_ as O,i as c,j as y,k as z,l as J,c as l,o as i,d as s,e as r,t as a,m as f,v as h,a as $,F as k,g as w,h as L,f as p,p as N}from"./app-DNKnZ930.js";import{f as j}from"./request-7grEb9by.js";const K={class:"project-list"},q={class:"list-header"},G={class:"stats"},H={class:"stat-item"},Q={class:"stat-number"},R={class:"stat-item"},W={class:"stat-number"},X={class:"stat-item"},Y={class:"stat-number"},Z={class:"filter-controls"},tt={class:"filter-group"},st={class:"filter-group"},et={class:"filter-group"},ot={key:0,class:"empty-state"},at={key:1,class:"projects-grid"},nt=["onClick"],lt={class:"project-content"},it={class:"project-header"},rt={class:"project-title"},dt={class:"project-meta"},ut={key:0,class:"project-category"},ct={key:1,class:"project-time"},vt={class:"project-description"},mt={key:0,class:"project-tags"},pt={key:0,class:"more-tags"},gt={class:"project-footer"},_t={class:"project-author"},yt={class:"project-date"},ft={class:"project-actions"},ht=["onClick"],kt={class:"modal-header"},wt={class:"modal-body"},bt={class:"project-detail-meta"},Ct={class:"detail-item"},Dt={key:0,class:"detail-item"},xt={key:1,class:"detail-item"},St={class:"detail-item"},It={class:"detail-item"},Pt={class:"detail-description"},Ft={key:0,class:"detail-tags"},Lt={class:"tags-list"},Nt={__name:"FarmList",setup(jt){const d=c([]),n=c(null),v=c(""),m=c(""),g=c("newest"),V=y(()=>d.value.filter(e=>e.status==="进行中").length),E=y(()=>d.value.filter(e=>e.status==="已完成").length),b=y(()=>{let e=d.value;return v.value&&(e=e.filter(t=>t.status===v.value)),m.value&&(e=e.filter(t=>t.category===m.value)),e.sort((t,o)=>{switch(g.value){case"oldest":return new Date(t.create_time)-new Date(o.create_time);case"name":return t.title.localeCompare(o.title);case"newest":default:return new Date(o.create_time)-new Date(t.create_time)}}),e}),C=async()=>{try{const e=await j.getFarmList();e.success&&(d.value=e.data.map(t=>({...t,name:t.title,createdAt:t.create_time})))}catch(e){console.error("获取项目列表失败:",e);const t=localStorage.getItem("farmProjects");t&&(d.value=JSON.parse(t))}},T=async e=>{try{await j.updateFarmProject(e.farm_id,{status:e.status})}catch(t){console.error("更新项目失败:",t),localStorage.setItem("farmProjects",JSON.stringify(d.value))}},A=e=>{n.value=e,document.body.style.overflow="hidden"},_=()=>{n.value=null,document.body.style.overflow=""},B=async e=>{const t=["计划中","进行中","暂停","已完成"],u=(t.indexOf(e.status)+1)%t.length;e.status=t[u],await T(e)},D=e=>({进行中:"status-progress",已完成:"status-completed",暂停:"status-paused",计划中:"status-planned"})[e]||"status-default",x=e=>({进行中:"🚀",已完成:"✅",暂停:"⏸️",计划中:"📋"})[e]||"📝",M=e=>({计划中:"🚀",进行中:"⏸️",暂停:"✅",已完成:"📋"})[e]||"🔄",S=e=>({"2D":"🎨","3D":"🎯"})[e]||"📁",U=(e,t)=>e.length<=t?e:e.substring(0,t)+"...",I=e=>new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric"}),P=e=>{C()},F=e=>{e.key==="Escape"&&n.value&&_()};return z(()=>{C(),window.addEventListener("projectAdded",P),document.addEventListener("keydown",F)}),J(()=>{window.removeEventListener("projectAdded",P),document.removeEventListener("keydown",F),document.body.style.overflow=""}),(e,t)=>(i(),l("div",K,[s("div",q,[t[7]||(t[7]=s("h3",null,"🌾 农场项目展示",-1)),s("div",G,[s("span",H,[s("span",Q,a(d.value.length),1),t[4]||(t[4]=s("span",{class:"stat-label"},"总项目数",-1))]),s("span",R,[s("span",W,a(V.value),1),t[5]||(t[5]=s("span",{class:"stat-label"},"进行中",-1))]),s("span",X,[s("span",Y,a(E.value),1),t[6]||(t[6]=s("span",{class:"stat-label"},"已完成",-1))])])]),s("div",Z,[s("div",tt,[t[9]||(t[9]=s("label",null,"状态筛选：",-1)),f(s("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>v.value=o)},[...t[8]||(t[8]=[$('<option value="" data-v-0a4bc479>全部状态</option><option value="进行中" data-v-0a4bc479>🚀 进行中</option><option value="已完成" data-v-0a4bc479>✅ 已完成</option><option value="暂停" data-v-0a4bc479>⏸️ 暂停</option><option value="计划中" data-v-0a4bc479>📋 计划中</option>',5)])],512),[[h,v.value]])]),s("div",st,[t[11]||(t[11]=s("label",null,"分类筛选：",-1)),f(s("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>m.value=o)},[...t[10]||(t[10]=[s("option",{value:""},"全部分类",-1),s("option",{value:"2D"},"🎨 2D",-1),s("option",{value:"3D"},"🎯 3D",-1)])],512),[[h,m.value]])]),s("div",et,[t[13]||(t[13]=s("label",null,"排序方式：",-1)),f(s("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>g.value=o)},[...t[12]||(t[12]=[s("option",{value:"newest"},"最新创建",-1),s("option",{value:"oldest"},"最早创建",-1),s("option",{value:"name"},"项目名称",-1)])],512),[[h,g.value]])])]),b.value.length===0?(i(),l("div",ot,[...t[14]||(t[14]=[s("div",{class:"empty-icon"},"🌱",-1),s("h4",null,"还没有项目哦",-1),s("p",null,"成为第一个在农场种下创意种子的人吧！",-1)])])):(i(),l("div",at,[(i(!0),l(k,null,w(b.value,o=>(i(),l("div",{key:o.id,class:"project-card",onClick:u=>A(o)},[s("div",lt,[s("div",it,[s("h4",rt,a(o.title),1),s("div",{class:L(["project-status",D(o.status)])},a(x(o.status))+" "+a(o.status),3)]),s("div",dt,[o.category?(i(),l("span",ut,a(S(o.category))+" "+a(o.category),1)):r("v-if",!0),o.expectedTime?(i(),l("span",ct," ⏰ "+a(o.expectedTime),1)):r("v-if",!0)]),s("p",vt,a(U(o.description,120)),1),o.tags&&o.tags.length>0?(i(),l("div",mt,[(i(!0),l(k,null,w(o.tags.slice(0,3),u=>(i(),l("span",{key:u,class:"project-tag"},a(u),1))),128)),o.tags.length>3?(i(),l("span",pt," +"+a(o.tags.length-3),1)):r("v-if",!0)])):r("v-if",!0),s("div",gt,[s("span",_t,"👤 "+a(o.author),1),s("span",yt,a(I(o.create_time)),1)])]),s("div",ft,[s("button",{onClick:N(u=>B(o),["stop"]),class:"action-btn status-btn"},a(M(o.status)),9,ht)])],8,nt))),128))])),r(" 项目详情模态框 "),n.value?(i(),l("div",{key:2,class:"modal-overlay",onClick:_},[s("div",{class:"modal-content",onClick:t[3]||(t[3]=N(()=>{},["stop"]))},[s("div",kt,[s("h3",null,a(n.value.title),1),s("button",{onClick:_,class:"close-btn"},"×")]),s("div",wt,[s("div",bt,[s("div",Ct,[t[15]||(t[15]=s("strong",null,"状态：",-1)),s("span",{class:L(["project-status",D(n.value.status)])},a(x(n.value.status))+" "+a(n.value.status),3)]),n.value.category?(i(),l("div",Dt,[t[16]||(t[16]=s("strong",null,"分类：",-1)),p(" "+a(S(n.value.category))+" "+a(n.value.category),1)])):r("v-if",!0),n.value.expectedTime?(i(),l("div",xt,[t[17]||(t[17]=s("strong",null,"预期完成时间：",-1)),p(" ⏰ "+a(n.value.expectedTime),1)])):r("v-if",!0),s("div",St,[t[18]||(t[18]=s("strong",null,"填写人：",-1)),p(" 👤 "+a(n.value.author),1)]),s("div",It,[t[19]||(t[19]=s("strong",null,"创建时间：",-1)),p(" "+a(I(n.value.create_time)),1)])]),s("div",Pt,[t[20]||(t[20]=s("strong",null,"项目描述：",-1)),s("p",null,a(n.value.description),1)]),n.value.tags&&n.value.tags.length>0?(i(),l("div",Ft,[t[21]||(t[21]=s("strong",null,"标签：",-1)),s("div",Lt,[(i(!0),l(k,null,w(n.value.tags,o=>(i(),l("span",{key:o,class:"detail-tag"},a(o),1))),128))])])):r("v-if",!0)])])])):r("v-if",!0)]))}},Tt=O(Nt,[["__scopeId","data-v-0a4bc479"]]);export{Tt as default};

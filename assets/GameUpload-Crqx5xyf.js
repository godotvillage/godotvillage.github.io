import{g as h,b as I}from"./request-CfbvxOJl.js";import{c as o,o as n,a as s,f as d,b as m,q as g,v as p,s as y,x as f,p as b,t as a,l as c,F,h as w}from"./app-B13rPDbg.js";import{_}from"./plugin-vue_export-helper-DlAUqK2U.js";const C={name:"GameUpload",data(){return{baseUrl:I,imageBaseUrl:I.replace(":31024",":31025"),gameInfo:{author:"",game_name:"",description:"",version:"",is_online_playable:!0},selectedFile:null,selectedCoverImage:null,coverPreview:null,isDragOver:!1,uploading:!1,loadingGames:!1,progress:0,result:{message:"",type:""},showGamesList:!1,games:[]}},methods:{triggerFileInput(){this.$refs.fileInput.click()},handleFileSelection(r){const e=r.target.files[0];e&&this.validateAndSetFile(e)},handleFileDrop(r){this.isDragOver=!1;const e=r.dataTransfer.files;e.length>0&&this.validateAndSetFile(e[0])},validateAndSetFile(r){if(!r.name.toLowerCase().endsWith(".zip")){this.showResult("请选择ZIP格式的文件","error");return}if(r.size>200*1024*1024){this.showResult("文件大小超过200MB限制","error");return}this.selectedFile=r,this.clearResult()},handleCoverImageChange(r){const e=r.target.files[0];if(!e){this.selectedCoverImage=null,this.coverPreview=null;return}if(!e.type.startsWith("image/")){this.showResult("请选择图片格式的文件","error"),r.target.value="";return}if(e.size>5*1024*1024){this.showResult("封面图片大小超过5MB限制","error"),r.target.value="";return}this.selectedCoverImage=e;const u=new FileReader;u.onload=v=>{this.coverPreview=v.target.result},u.readAsDataURL(e)},validateForm(){return this.gameInfo.author.trim()&&this.gameInfo.game_name.trim()&&this.gameInfo.version.trim()},async uploadGame(){if(!this.selectedFile)return;if(!this.validateForm()){this.showResult("❌ 请填写所有必填字段（作者、游戏名、版本）","error");return}const r=new FormData;r.append("zipfile",this.selectedFile),this.selectedCoverImage&&r.append("coverImage",this.selectedCoverImage),r.append("author",this.gameInfo.author.trim()),r.append("game_name",this.gameInfo.game_name.trim()),r.append("description",this.gameInfo.description.trim()),r.append("version",this.gameInfo.version.trim()),r.append("is_online_playable",this.gameInfo.is_online_playable),this.uploading=!0,this.progress=0;try{const e=await h.uploadGame(r);if(e.success){let u=`✅ ${e.message}<br>`;u+=`游戏ID: ${e.game_id}<br>`,u+=`文件夹: ${e.folderName}<br>`,e.gameInfo&&(u+=`作者: ${e.gameInfo.author}<br>`,u+=`游戏名: ${e.gameInfo.game_name}<br>`,u+=`版本: ${e.gameInfo.version}<br>`,u+=`在线游玩: ${e.gameInfo.is_online_playable?"是":"否"}`),this.showResult(u,"success"),this.resetForm()}else this.showResult(`❌ ${e.error}`,"error")}catch(e){this.showResult(`❌ ${e.message}`,"error")}finally{this.uploading=!1,this.progress=0}},async loadGames(){this.loadingGames=!0;try{const r=await h.getGames();r.success?(this.games=r.data,this.showGamesList=!0):this.showResult(`❌ 获取游戏列表失败: ${r.error}`,"error")}catch(r){this.showResult(`❌ ${r.message}`,"error")}finally{this.loadingGames=!1}},resetForm(){this.gameInfo={author:"",game_name:"",description:"",version:"",is_online_playable:!0},this.selectedFile=null,this.selectedCoverImage=null,this.coverPreview=null,this.$refs.fileInput.value=""},showResult(r,e){this.result={message:r,type:e}},clearResult(){this.result={message:"",type:""}},formatDate(r){return new Date(r).toLocaleString("zh-CN")}}},k={class:"game-upload-container"},D={class:"form-group"},G={class:"form-group"},x={class:"form-group"},R={class:"form-group"},P={class:"form-group"},B={class:"checkbox-label"},M={class:"form-group"},U=["src"],z={class:"file-upload-section"},S={key:0},L={key:1},V={key:2},Z=["disabled"],A=["disabled"],N={key:0,class:"progress"},O=["innerHTML"],T={key:2,class:"games-list"},q={key:0,class:"no-games"},W={key:1,class:"games-container"},H={class:"game-card-content"},E={class:"game-cover"},j=["src","alt"],J={key:1,class:"no-cover"},K={class:"game-info"};function Q(r,e,u,v,t,i){return n(),o("div",k,[e[31]||(e[31]=s("h1",null,"游戏ZIP文件上传",-1)),e[32]||(e[32]=s("p",null,[m(" 请上传一个由 Godot 导出的 Web 版本 ZIP 包，文件内必须包含 "),s("code",null,"index.html"),m("。"),s("br"),m(" 上传前请填写作者、游戏名、版本、封面等相关信息。仅支持 ZIP 格式，最大 200MB。 ")],-1)),d(" 游戏信息表单 "),s("form",{onSubmit:e[6]||(e[6]=f((...l)=>i.uploadGame&&i.uploadGame(...l),["prevent"])),class:"game-info-form"},[s("div",D,[e[14]||(e[14]=s("label",{for:"author"},"作者 *",-1)),g(s("input",{type:"text",id:"author","onUpdate:modelValue":e[0]||(e[0]=l=>t.gameInfo.author=l),required:"",class:"form-input"},null,512),[[p,t.gameInfo.author]])]),s("div",G,[e[15]||(e[15]=s("label",{for:"game_name"},"游戏名 *",-1)),g(s("input",{type:"text",id:"game_name","onUpdate:modelValue":e[1]||(e[1]=l=>t.gameInfo.game_name=l),required:"",class:"form-input"},null,512),[[p,t.gameInfo.game_name]])]),s("div",x,[e[16]||(e[16]=s("label",{for:"description"},"游戏简介",-1)),g(s("textarea",{id:"description","onUpdate:modelValue":e[2]||(e[2]=l=>t.gameInfo.description=l),rows:"3",class:"form-textarea"},null,512),[[p,t.gameInfo.description]])]),s("div",R,[e[17]||(e[17]=s("label",{for:"version"},"版本 *",-1)),g(s("input",{type:"text",id:"version","onUpdate:modelValue":e[3]||(e[3]=l=>t.gameInfo.version=l),required:"",placeholder:"例: 1.0.0",class:"form-input"},null,512),[[p,t.gameInfo.version]])]),s("div",P,[s("label",B,[g(s("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=l=>t.gameInfo.is_online_playable=l),disabled:""},null,512),[[y,t.gameInfo.is_online_playable]]),e[18]||(e[18]=m(" 支持在线游玩 ",-1))])]),s("div",M,[e[19]||(e[19]=s("label",{for:"coverImage"},"游戏封面",-1)),s("input",{type:"file",id:"coverImage",onChange:e[5]||(e[5]=(...l)=>i.handleCoverImageChange&&i.handleCoverImageChange(...l)),accept:"image/*",class:"form-input"},null,32),t.coverPreview?(n(),o("img",{key:0,src:t.coverPreview,alt:"封面预览",class:"cover-preview"},null,8,U)):d("v-if",!0)])],32),s("div",z,[e[21]||(e[21]=s("h3",null,"游戏文件上传",-1)),s("div",{class:b(["upload-area",{dragover:t.isDragOver}]),onClick:e[8]||(e[8]=(...l)=>i.triggerFileInput&&i.triggerFileInput(...l)),onDragover:e[9]||(e[9]=f(l=>t.isDragOver=!0,["prevent"])),onDragleave:e[10]||(e[10]=l=>t.isDragOver=!1),onDrop:e[11]||(e[11]=f((...l)=>i.handleFileDrop&&i.handleFileDrop(...l),["prevent"]))},[t.selectedFile?d("v-if",!0):(n(),o("p",S,"点击选择ZIP文件或拖拽文件到这里")),t.selectedFile?d("v-if",!0):(n(),o("p",L,[...e[20]||(e[20]=[s("small",null,"支持ZIP格式，最大200MB",-1)])])),t.selectedFile?(n(),o("div",V,[s("p",null,"已选择文件: "+a(t.selectedFile.name),1),s("p",null,[s("small",null,"大小: "+a((t.selectedFile.size/1024/1024).toFixed(2))+" MB",1)])])):d("v-if",!0),s("input",{ref:"fileInput",type:"file",accept:".zip",onChange:e[7]||(e[7]=(...l)=>i.handleFileSelection&&i.handleFileSelection(...l)),style:{display:"none"}},null,544)],34)]),s("button",{type:"button",onClick:e[12]||(e[12]=(...l)=>i.uploadGame&&i.uploadGame(...l)),disabled:!t.selectedFile||t.uploading,class:"upload-btn"},a(t.uploading?"上传中...":"上传游戏"),9,Z),s("button",{type:"button",onClick:e[13]||(e[13]=(...l)=>i.loadGames&&i.loadGames(...l)),disabled:t.loadingGames,class:"upload-btn load-games-btn"},a(t.loadingGames?"加载中...":"查看游戏列表"),9,A),t.uploading?(n(),o("div",N,[s("div",{class:"progress-bar",style:c({width:t.progress+"%"})},null,4)])):d("v-if",!0),t.result.message?(n(),o("div",{key:1,class:b(["result",t.result.type])},[s("div",{innerHTML:t.result.message},null,8,O)],2)):d("v-if",!0),d(" 游戏列表显示区域 "),t.showGamesList?(n(),o("div",T,[e[30]||(e[30]=s("h2",null,"游戏列表",-1)),t.games.length===0?(n(),o("div",q,[...e[22]||(e[22]=[s("p",null,"暂无游戏",-1)])])):(n(),o("div",W,[(n(!0),o(F,null,w(t.games,l=>(n(),o("div",{key:l.game_id,class:"game-card"},[s("div",H,[s("div",E,[l.cover_image?(n(),o("img",{key:0,src:`${t.imageBaseUrl}/${l.cover_image}`,alt:`${l.game_name} 封面`,class:"cover-image"},null,8,j)):(n(),o("p",J,"暂无封面"))]),s("div",K,[s("h3",null,a(l.game_name),1),s("p",null,[e[23]||(e[23]=s("strong",null,"作者:",-1)),m(" "+a(l.author),1)]),s("p",null,[e[24]||(e[24]=s("strong",null,"版本:",-1)),m(" "+a(l.version),1)]),s("p",null,[e[25]||(e[25]=s("strong",null,"游戏ID:",-1)),m(" "+a(l.game_id),1)]),s("p",null,[e[26]||(e[26]=s("strong",null,"简介:",-1)),m(" "+a(l.description||"暂无简介"),1)]),s("p",null,[e[27]||(e[27]=s("strong",null,"在线游玩:",-1)),m(" "+a(l.is_online_playable?"支持":"不支持"),1)]),s("p",null,[e[28]||(e[28]=s("strong",null,"上传时间:",-1)),m(" "+a(i.formatDate(l.upload_time)),1)]),s("p",null,[e[29]||(e[29]=s("strong",null,"文件大小:",-1)),m(" "+a((l.file_size/1024/1024).toFixed(2))+" MB",1)])])])]))),128))]))])):d("v-if",!0)])}const ee=_(C,[["render",Q],["__scopeId","data-v-33162148"]]);export{ee as default};

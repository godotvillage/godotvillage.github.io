import{g as s}from"./githubAuth-BlkOu_e-.js";import{_ as m,c as l,o as u,e as i,d as o,t as h,F as g,f as p}from"./app-KfR34fJl.js";import"./request-7grEb9by.js";const k={name:"GitHubLogin",data(){return{currentUser:null,mockUsername:"",isDevelopment:!1}},computed:{isLoggedIn(){return!!this.currentUser}},mounted(){this.handleOAuthCallback(),this.loadUserInfo(),window.addEventListener("storage",this.handleStorageChange)},beforeUnmount(){window.removeEventListener("storage",this.handleStorageChange)},methods:{async handleOAuthCallback(){const e=new URLSearchParams(window.location.search),r=e.get("code"),a=e.get("state");if(r&&a){const d=window.location.pathname+window.location.hash;window.history.replaceState({},document.title,d);try{const t=await s.handleCallback(r,a);this.currentUser=t,this.$emit("login",t)}catch(t){console.error("OAuth回调处理失败:",t),this.$emit("error","GitHub登录失败，请重试");const n=window.location.pathname+window.location.hash;window.history.replaceState({},document.title,n)}}},loadUserInfo(){this.currentUser=s.getCurrentUser()},login(){try{s.login()}catch(e){console.error("登录失败:",e),this.$emit("error","登录失败，请重试")}},logout(){try{s.logout(),this.currentUser=null,this.$emit("logout")}catch(e){console.error("登出失败:",e)}},mockLogin(){if(!this.mockUsername.trim()){alert("请输入GitHub用户名");return}try{const e=s.mockLogin(this.mockUsername.trim());this.currentUser=e,this.mockUsername="",this.$emit("login",e)}catch(e){console.error("模拟登录失败:",e),this.$emit("error","模拟登录失败")}},handleStorageChange(e){e.key==="github_user"&&this.loadUserInfo()}}},v={class:"github-login"},w={key:0,class:"user-info"},U=["src","alt"],_={class:"user-details"},b={class:"user-name"},f={class:"user-login"},y={class:"user-actions"},C={class:"login-prompt"};function L(e,r,a,d,t,n){return u(),l("div",v,[i(" 已登录状态 "),n.isLoggedIn?(u(),l("div",w,[o("img",{src:t.currentUser.avatar_url,alt:t.currentUser.login,class:"user-avatar"},null,8,U),o("div",_,[o("span",b,h(t.currentUser.name||t.currentUser.login),1),o("span",f,"@"+h(t.currentUser.login),1)]),o("div",y,[o("button",{onClick:r[0]||(r[0]=(...c)=>n.logout&&n.logout(...c)),class:"logout-btn",title:"登出"}," 🚪 ")])])):(u(),l(g,{key:1},[i(" 未登录状态 "),o("div",C,[o("button",{onClick:r[1]||(r[1]=(...c)=>n.login&&n.login(...c)),class:"login-btn"},[...r[2]||(r[2]=[o("svg",{class:"github-icon",viewBox:"0 0 16 16",width:"16",height:"16"},[o("path",{fill:"currentColor",d:"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"})],-1),p(" 使用 GitHub 登录 ",-1)])]),i(" 开发模式下的模拟登录 "),i(` <div v-if="isDevelopment" class="dev-login">
        <hr class="divider" />
        <p class="dev-note">开发模式 - 模拟登录</p>
        <div class="mock-login-form">
          <input 
            v-model="mockUsername" 
            placeholder="输入GitHub用户名" 
            class="mock-input"
            @keyup.enter="mockLogin"
          />
          <button @click="mockLogin" class="mock-login-btn">模拟登录</button>
        </div>
      </div> `)])],2112))])}const I=m(k,[["render",L],["__scopeId","data-v-652c88d6"]]);export{I as default};

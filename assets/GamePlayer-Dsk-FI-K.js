import{g as d,b as f}from"./request-CfbvxOJl.js";import{_ as c}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as r,o as l,f as n,a as o,t as m}from"./app-DMsCKgYK.js";const u={name:"GamePlayer",data(){return{baseUrl:f,imageBaseUrl:f.replace(":31024",":31025"),gameId:null,gameInfo:null,loading:!1,error:null,showGameFrame:!1,gameStarting:!1,gameUrl:""}},mounted(){this.initGame()},methods:{initGame(){const a=new URLSearchParams(window.location.search);this.gameId=a.get("id"),this.gameId&&this.loadGameInfo()},async loadGameInfo(){this.loading=!0,this.error=null;try{const a=await d.getGames();if(a.success){const s=a.data.find(g=>g.folder_name===this.gameId);s?this.gameInfo=s:this.error="未找到指定的游戏"}else this.error=`获取游戏信息失败: ${a.error}`}catch(a){this.error=a.message}finally{this.loading=!1}},async startGame(){if(this.gameInfo.is_online_playable){this.gameStarting=!0;try{this.gameUrl=`http://117.72.182.158:31025/games/${this.gameId}/index.html`,this.showGameFrame=!0}catch(a){this.error=`启动游戏失败: ${a.message}`}finally{this.gameStarting=!1}}},stopGame(){this.showGameFrame=!1,this.gameUrl=""},downloadGame(){const a=d.getDownloadUrl(this.gameId);window.open(a,"_blank")},goToGameList(){window.location.href="/game/list.html"},formatDate(a){return new Date(a).toLocaleString("zh-CN")}}},_={class:"game-player-container"},h={key:0,class:"loading"},p={key:1,class:"error-message"},v={key:2,class:"no-game-selected"},I={key:3,class:"game-container"},y={class:"game-header"},G={class:"game-info"},b={class:"game-meta"},k={class:"author"},w={class:"version"},U={class:"upload-time"},C={key:0,class:"description"},S={key:0,class:"game-cover"},L=["src","alt"],B={class:"game-controls"},D=["disabled"],F={key:0,class:"game-frame-container"},T={class:"game-frame-header"},x=["src"],P={key:1,class:"offline-notice"};function N(a,s,g,z,e,t){return l(),r("div",_,[e.loading?(l(),r("div",h,[...s[6]||(s[6]=[o("p",null,"正在加载游戏...",-1)])])):n("v-if",!0),e.error?(l(),r("div",p,[s[7]||(s[7]=o("h2",null,"加载失败",-1)),o("p",null,m(e.error),1),o("button",{onClick:s[0]||(s[0]=i=>a.$router.go(-1)),class:"back-btn"},"返回游戏列表")])):n("v-if",!0),!e.loading&&!e.error&&!e.gameId?(l(),r("div",v,[s[8]||(s[8]=o("h2",null,"未选择游戏",-1)),s[9]||(s[9]=o("p",null,"请从游戏列表中选择一个游戏进行游玩。",-1)),o("button",{onClick:s[1]||(s[1]=(...i)=>t.goToGameList&&t.goToGameList(...i)),class:"back-btn"},"前往游戏列表")])):n("v-if",!0),e.gameInfo&&!e.loading&&!e.error?(l(),r("div",I,[n(" 游戏信息 "),o("div",y,[o("div",G,[o("h1",null,m(e.gameInfo.game_name),1),o("div",b,[o("span",k,"作者: "+m(e.gameInfo.author),1),o("span",w,"版本: "+m(e.gameInfo.version),1),o("span",U,"上传时间: "+m(t.formatDate(e.gameInfo.upload_time)),1)]),e.gameInfo.description?(l(),r("p",C,m(e.gameInfo.description),1)):n("v-if",!0)]),e.gameInfo.cover_image?(l(),r("div",S,[o("img",{src:`${e.imageBaseUrl}/${e.gameInfo.cover_image}`,alt:`${e.gameInfo.game_name} 封面`,class:"cover-image"},null,8,L)])):n("v-if",!0)]),n(" 游戏控制按钮 "),o("div",B,[o("button",{onClick:s[2]||(s[2]=(...i)=>t.goToGameList&&t.goToGameList(...i)),class:"control-btn secondary"},"返回列表"),e.gameInfo.is_online_playable?(l(),r("button",{key:0,onClick:s[3]||(s[3]=(...i)=>t.startGame&&t.startGame(...i)),disabled:e.gameStarting,class:"control-btn primary"},m(e.gameStarting?"加载中...":"开始游戏"),9,D)):(l(),r("button",{key:1,onClick:s[4]||(s[4]=(...i)=>t.downloadGame&&t.downloadGame(...i)),class:"control-btn primary"}," 下载游戏 "))]),n(" 游戏播放区域 "),e.showGameFrame&&e.gameInfo.is_online_playable?(l(),r("div",F,[o("div",T,[o("span",null,m(e.gameInfo.game_name),1),o("button",{onClick:s[5]||(s[5]=(...i)=>t.stopGame&&t.stopGame(...i)),class:"close-game-btn"},"×")]),o("iframe",{src:e.gameUrl,class:"game-frame",frameborder:"0",allowfullscreen:""},null,8,x)])):n("v-if",!0),n(" 不支持在线游玩的提示 "),e.gameInfo.is_online_playable?n("v-if",!0):(l(),r("div",P,[s[10]||(s[10]=o("h3",null,"此游戏不支持在线游玩",-1)),o("p",null,"请下载游戏文件到本地运行。游戏文件大小: "+m((e.gameInfo.file_size/1024/1024).toFixed(2))+" MB",1)]))])):n("v-if",!0)])}const M=c(u,[["render",N],["__scopeId","data-v-01fdf798"]]);export{M as default};

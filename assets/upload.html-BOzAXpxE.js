import{_ as w}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as $,a as o,f as u,d as k,b as f,o as L}from"./app-BiNfS7Uw.js";const _={mounted(){const l=document.getElementById("uploadArea"),r=document.getElementById("fileInput"),y=document.getElementById("coverImage"),p=document.getElementById("coverPreview"),i=document.getElementById("uploadBtn"),d=document.getElementById("loadGamesBtn"),b=document.getElementById("progressContainer"),h=document.getElementById("progressBar"),g=document.getElementById("result"),I=document.getElementById("gamesList"),v=document.getElementById("gamesContainer");let c=null,m=null;l.addEventListener("click",()=>{r.click()}),l.addEventListener("dragover",e=>{e.preventDefault(),l.classList.add("dragover")}),l.addEventListener("dragleave",()=>{l.classList.remove("dragover")}),l.addEventListener("drop",e=>{e.preventDefault(),l.classList.remove("dragover");const a=e.dataTransfer.files;a.length>0&&x(a[0])}),r.addEventListener("change",e=>{e.target.files.length>0&&x(e.target.files[0])});function x(e){if(!e.name.toLowerCase().endsWith(".zip")){s("请选择ZIP格式的文件","error");return}if(e.size>200*1024*1024){s("文件大小超过200MB限制","error");return}c=e,i.disabled=!1,l.innerHTML=`<p>已选择文件: ${e.name}</p><p><small>大小: ${(e.size/1024/1024).toFixed(2)} MB</small></p>`}y.addEventListener("change",e=>{if(e.target.files.length>0){const a=e.target.files[0];if(!a.type.startsWith("image/")){s("请选择图片格式的文件","error"),e.target.value="";return}if(a.size>5*1024*1024){s("封面图片大小超过5MB限制","error"),e.target.value="";return}m=a;const t=new FileReader;t.onload=function(n){p.src=n.target.result,p.style.display="block"},t.readAsDataURL(a)}else m=null,p.style.display="none"});function B(){const e=document.getElementById("author").value.trim(),a=document.getElementById("game_name").value.trim(),t=document.getElementById("version").value.trim();return e&&a&&t}i.addEventListener("click",async()=>{if(!c)return;if(!B()){s("❌ 请填写所有必填字段（作者、游戏名、版本）","error");return}const e=new FormData;e.append("zipfile",c),m&&e.append("coverImage",m),e.append("author",document.getElementById("author").value.trim()),e.append("game_name",document.getElementById("game_name").value.trim()),e.append("description",document.getElementById("description").value.trim()),e.append("version",document.getElementById("version").value.trim()),e.append("is_online_playable",document.getElementById("is_online_playable").checked),b.style.display="block",i.disabled=!0;try{const t=await(await fetch("http://117.72.182.158:31024/upload",{method:"POST",body:e})).json();if(t.success){let n=`✅ ${t.message}<br>`;n+=`游戏ID: ${t.game_id}<br>`,n+=`文件夹: ${t.folderName}<br>`,t.gameInfo&&(n+=`作者: ${t.gameInfo.author}<br>`,n+=`游戏名: ${t.gameInfo.game_name}<br>`,n+=`版本: ${t.gameInfo.version}<br>`,n+=`在线游玩: ${t.gameInfo.is_online_playable?"是":"否"}`),s(n,"success"),document.getElementById("gameInfoForm").reset(),c=null,m=null,p.style.display="none",l.innerHTML="<p>点击选择ZIP文件或拖拽文件到这里</p><p><small>支持ZIP格式，最大200MB</small></p>",i.disabled=!0}else s(`❌ ${t.error}`,"error")}catch(a){s(`❌ 上传失败: ${a.message}`,"error")}finally{b.style.display="none",h.style.width="0%",i.disabled=!1}}),d.addEventListener("click",async()=>{try{d.disabled=!0,d.textContent="加载中...";const a=await(await fetch("http://117.72.182.158:31024/games")).json();a.success?(E(a.data),I.style.display="block"):s(`❌ 获取游戏列表失败: ${a.error}`,"error")}catch(e){s(`❌ 获取游戏列表失败: ${e.message}`,"error")}finally{d.disabled=!1,d.textContent="查看游戏列表"}});function E(e){if(e.length===0){v.innerHTML="<p>暂无游戏</p>";return}let a="";e.forEach(t=>{const n=t.cover_image?`<img src="http://117.72.182.158:31025/${t.cover_image}" alt="${t.game_name} 封面" style="max-width: 150px; max-height: 150px; margin-bottom: 10px; border-radius: 5px;">`:'<p style="color: #888; font-style: italic;">暂无封面</p>';a+=`
                    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 15px; background-color: #f9f9f9;">
                        <div style="display: flex; align-items: flex-start; gap: 15px;">
                            <div style="flex-shrink: 0;">
                                ${n}
                            </div>
                            <div style="flex-grow: 1;">
                                <h3 style="margin: 0 0 10px 0; color: #333;">${t.game_name}</h3>
                                <p><strong>作者:</strong> ${t.author}</p>
                                <p><strong>版本:</strong> ${t.version}</p>
                                <p><strong>游戏ID:</strong> ${t.game_id}</p>
                                <p><strong>简介:</strong> ${t.description||"暂无简介"}</p>
                                <p><strong>在线游玩:</strong> ${t.is_online_playable?"支持":"不支持"}</p>
                                <p><strong>上传时间:</strong> ${new Date(t.upload_time).toLocaleString("zh-CN")}</p>
                                <p><strong>文件大小:</strong> ${(t.file_size/1024/1024).toFixed(2)} MB</p>
                            </div>
                        </div>
                    </div>
                `}),v.innerHTML=a}function s(e,a){g.innerHTML=e,g.className=`result ${a}`,g.style.display="block"}}};function C(l,r,y,p,i,d){return L(),$("div",null,[r[0]||(r[0]=o("h1",null,"游戏ZIP文件上传",-1)),r[1]||(r[1]=o("p",null,[f(" 请上传一个由 Godot 导出的 Web 版本 ZIP 包，文件内必须包含 "),o("code",null,"index.html"),f("。"),o("br"),f(" 上传前请填写作者、游戏名、版本、封面等相关信息。仅支持 ZIP 格式，最大 200MB。 ")],-1)),u(" 游戏信息表单 "),r[2]||(r[2]=k('<form id="gameInfoForm"><div style="margin-bottom:15px;"><label for="author" style="display:block;margin-bottom:5px;font-weight:bold;">作者 *</label><input type="text" id="author" name="author" required style="width:100%;padding:8px;border:1px solid #ccc;border-radius:4px;"></div><div style="margin-bottom:15px;"><label for="game_name" style="display:block;margin-bottom:5px;font-weight:bold;">游戏名 *</label><input type="text" id="game_name" name="game_name" required style="width:100%;padding:8px;border:1px solid #ccc;border-radius:4px;"></div><div style="margin-bottom:15px;"><label for="description" style="display:block;margin-bottom:5px;font-weight:bold;">游戏简介</label><textarea id="description" name="description" rows="3" style="width:100%;padding:8px;border:1px solid #ccc;border-radius:4px;resize:vertical;"></textarea></div><div style="margin-bottom:15px;"><label for="version" style="display:block;margin-bottom:5px;font-weight:bold;">版本 *</label><input type="text" id="version" name="version" required placeholder="例: 1.0.0" style="width:100%;padding:8px;border:1px solid #ccc;border-radius:4px;"></div><div style="margin-bottom:15px;"><label style="display:block;margin-bottom:5px;font-weight:bold;"><input type="checkbox" id="is_online_playable" name="is_online_playable" value="true" checked disabled style="margin-right:8px;"> 支持在线游玩 </label></div><div style="margin-bottom:15px;"><label for="coverImage" style="display:block;margin-bottom:5px;font-weight:bold;">游戏封面</label><input type="file" id="coverImage" name="coverImage" accept="image/*" style="width:100%;padding:8px;border:1px solid #ccc;border-radius:4px;"><img id="coverPreview" class="cover-preview" alt="封面预览"></div></form><div class="file-upload-section"><h3>游戏文件上传</h3><div class="upload-area" id="uploadArea"><p>点击选择ZIP文件或拖拽文件到这里</p><p><small>支持ZIP格式，最大200MB</small></p><input type="file" id="fileInput" class="file-input" accept=".zip"></div></div><p><button id="uploadBtn" class="upload-btn" disabled>上传游戏</button></p>',3)),u(" 添加游戏列表按钮 "),r[3]||(r[3]=o("p",null,[o("button",{id:"loadGamesBtn",class:"upload-btn",style:{"margin-left":"10px","background-color":"#28a745"}},"查看游戏列表")],-1)),r[4]||(r[4]=o("div",{class:"progress",id:"progressContainer"},[o("div",{class:"progress-bar",id:"progressBar"})],-1)),r[5]||(r[5]=o("div",{class:"result",id:"result"},null,-1)),u(" 游戏列表显示区域 "),r[6]||(r[6]=o("div",{id:"gamesList",style:{"margin-top":"30px",display:"none"}},[o("h2",null,"游戏列表"),o("div",{id:"gamesContainer"})],-1))])}const T=w(_,[["render",C]]),z=JSON.parse('{"path":"/game/upload.html","title":"游戏上传页面","lang":"zh-CN","frontmatter":{"title":"游戏上传页面","index":false,"icon":"laptop-code","sidebar":false,"comment":false,"lastUpdated":false,"editLink":false,"contributors":false,"breadcrumb":true,"category":["游戏"],"author":false,"pageInfo":false,"toc":false,"feed":false,"seo":false,"head":[]},"git":{"createdTime":1760082150000,"updatedTime":1760084908000},"readingTime":{"minutes":5.19,"words":1558},"filePathRelative":"game/upload.md"}');export{T as comp,z as data};

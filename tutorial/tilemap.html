<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.24" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.94" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"瓦片地图详解","image":["https://godotvillage.github.io/assets/images/tutorial/tilemap/tilemap_classes.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/add-tilemap-node.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/tilesetpanel.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/tilemap-panel.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/terrainset.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/tileset-draw-terrain.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/use-tileset-terrain.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/match_corner_example.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/match_sides_example.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/match_corner_and_sides_example.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/match_corner_and_sides.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/tilemap_physics_layer.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/tilemap_physics_draw.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/tilemap_physics.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/tilemap_physics2.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/tilemap_physics_draw.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/tilemap_navigation_example.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/tilemap_bake_navation_region.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/tileset-light.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/tileset_with_no_ysort.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/tileset_with_ysort.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/tilemap_scene_collection.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/tilemap_add_scene.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/example3-1.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/example4-1.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/example4-2.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/example4-3.png","https://godotvillage.github.io/assets/images/tutorial/tilemap/example4-4.png"],"datePublished":"2025-10-23T00:00:00.000Z","dateModified":"2025-11-05T09:53:38.000Z","author":[{"@type":"Person","name":"Goodman"},{"@type":"Person","name":"陌上竹"}]}</script><meta property="og:url" content="https://godotvillage.github.io/tutorial/tilemap.html"><meta property="og:site_name" content="Godot新手村"><meta property="og:title" content="瓦片地图详解"><meta property="og:description" content="简介 图块地图（Tile Map）是Godot中功能强大的2d地图制作节点，由于TileMap在Godot4.5已废弃，且与TileMapLayer使用其实差异不大，故本篇主要讲解 TileMapLayer。本篇为快速教程，指在方便用户快速上手TileMapLayer。 相关信息 在Godot 4.3之后的版本添加了TilemapLayer替代原有的T..."><meta property="og:type" content="article"><meta property="og:image" content="https://godotvillage.github.io/assets/images/tutorial/tilemap/tilemap_classes.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-11-05T09:53:38.000Z"><meta property="article:author" content="Goodman"><meta property="article:tag" content="瓦片地图"><meta property="article:published_time" content="2025-10-23T00:00:00.000Z"><meta property="article:modified_time" content="2025-11-05T09:53:38.000Z"><title>瓦片地图详解 | Godot新手村</title><meta name="description" content="简介 图块地图（Tile Map）是Godot中功能强大的2d地图制作节点，由于TileMap在Godot4.5已废弃，且与TileMapLayer使用其实差异不大，故本篇主要讲解 TileMapLayer。本篇为快速教程，指在方便用户快速上手TileMapLayer。 相关信息 在Godot 4.3之后的版本添加了TilemapLayer替代原有的T...">
    <link rel="preload" href="/assets/style-BktXC5tG.css" as="style"><link rel="stylesheet" href="/assets/style-BktXC5tG.css">
    <link rel="modulepreload" href="/assets/app-DI3rh0pQ.js"><link rel="modulepreload" href="/assets/tilemap.html-BNzclRZa.js">
    <link rel="prefetch" href="/assets/index.html-JyZOWfnz.js" as="script"><link rel="prefetch" href="/assets/intro.html-B4VB0M6m.js" as="script"><link rel="prefetch" href="/assets/index.html-CRCiL0m6.js" as="script"><link rel="prefetch" href="/assets/index.html-CdHZAbrP.js" as="script"><link rel="prefetch" href="/assets/index.html-BEpYkm1x.js" as="script"><link rel="prefetch" href="/assets/list.html-RRDd-d-M.js" as="script"><link rel="prefetch" href="/assets/index.html-BVQEEOwk.js" as="script"><link rel="prefetch" href="/assets/list.html-BY6oG69C.js" as="script"><link rel="prefetch" href="/assets/play.html-HIsGkUOS.js" as="script"><link rel="prefetch" href="/assets/upload.html-kM2lOKyE.js" as="script"><link rel="prefetch" href="/assets/index.html-ueDMczfC.js" as="script"><link rel="prefetch" href="/assets/index.html-BI6gA7rW.js" as="script"><link rel="prefetch" href="/assets/index.html-Wtt6U-5p.js" as="script"><link rel="prefetch" href="/assets/index.html-DKUR-ckD.js" as="script"><link rel="prefetch" href="/assets/assetweb.html-CY-TV_a4.js" as="script"><link rel="prefetch" href="/assets/component.html-CtmVuawi.js" as="script"><link rel="prefetch" href="/assets/file.html-ipT9N7pp.js" as="script"><link rel="prefetch" href="/assets/fsm.html-WfIjoyI6.js" as="script"><link rel="prefetch" href="/assets/luoye.html-CjzxL9S0.js" as="script"><link rel="prefetch" href="/assets/navigation.html-CJtdkF4V.js" as="script"><link rel="prefetch" href="/assets/otherbilibili.html-d45R2DaC.js" as="script"><link rel="prefetch" href="/assets/signal.html-_6F-Tlhv.js" as="script"><link rel="prefetch" href="/assets/single.html-BUUCD-a9.js" as="script"><link rel="prefetch" href="/assets/index.html-BI_o-Nts.js" as="script"><link rel="prefetch" href="/assets/painter.html-2gT8g_Ak.js" as="script"><link rel="prefetch" href="/assets/intro.html-CvSHkQiT.js" as="script"><link rel="prefetch" href="/assets/404.html-BBc4jxd-.js" as="script"><link rel="prefetch" href="/assets/index.html-CTGlKsld.js" as="script"><link rel="prefetch" href="/assets/index.html-BZahJ8lG.js" as="script"><link rel="prefetch" href="/assets/index.html-Yrv1NcK0.js" as="script"><link rel="prefetch" href="/assets/index.html-rF_vmLIG.js" as="script"><link rel="prefetch" href="/assets/index.html-Ca14JHEJ.js" as="script"><link rel="prefetch" href="/assets/index.html-DtDBHNVU.js" as="script"><link rel="prefetch" href="/assets/index.html-Doke3SbQ.js" as="script"><link rel="prefetch" href="/assets/index.html-BfhSCJII.js" as="script"><link rel="prefetch" href="/assets/index.html-KE0ZKbMk.js" as="script"><link rel="prefetch" href="/assets/index.html-D0pG1L4k.js" as="script"><link rel="prefetch" href="/assets/index.html-BQHoIpDM.js" as="script"><link rel="prefetch" href="/assets/index.html-IFJjBFNC.js" as="script"><link rel="prefetch" href="/assets/index.html-9wa6izbs.js" as="script"><link rel="prefetch" href="/assets/index.html-N69DFyku.js" as="script"><link rel="prefetch" href="/assets/index.html-CMcAQThz.js" as="script"><link rel="prefetch" href="/assets/index.html-C0hTmiDj.js" as="script"><link rel="prefetch" href="/assets/index.html-BZ-mpcmA.js" as="script"><link rel="prefetch" href="/assets/index.html-CI__Pj1a.js" as="script"><link rel="prefetch" href="/assets/index.html-DBoQklQW.js" as="script"><link rel="prefetch" href="/assets/index.html-DEVDwpxg.js" as="script"><link rel="prefetch" href="/assets/index.html-BmvuGIN6.js" as="script"><link rel="prefetch" href="/assets/index.html-BrmzxHkf.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-CKV1Bsxh.js" as="script"><link rel="prefetch" href="/assets/index-BrzB_qDf.js" as="script"><link rel="prefetch" href="/assets/AlbumCropping-DucfibmK.js" as="script"><link rel="prefetch" href="/assets/BiliBlackboard-Cqw8EHR-.js" as="script"><link rel="prefetch" href="/assets/DiscussionDetail-Cth8bHOr.js" as="script"><link rel="prefetch" href="/assets/DiscussionsList-CBnLwgZn.js" as="script"><link rel="prefetch" href="/assets/FarmList-Dw_MY6nF.js" as="script"><link rel="prefetch" href="/assets/FarmSearch-DPOu1w0W.js" as="script"><link rel="prefetch" href="/assets/FarmStats-RGrK-zNa.js" as="script"><link rel="prefetch" href="/assets/FarmSubmitForm-DMU_1XVr.js" as="script"><link rel="prefetch" href="/assets/GameJamCountdown-mgZjwfG9.js" as="script"><link rel="prefetch" href="/assets/GameList-CboY10qg.js" as="script"><link rel="prefetch" href="/assets/GamePlayer-Dtz-5ETo.js" as="script"><link rel="prefetch" href="/assets/GameUpload-DnkZP4PO.js" as="script"><link rel="prefetch" href="/assets/GitHubLogin-CB0rE6TW.js" as="script"><link rel="prefetch" href="/assets/ProjectTracker-DjAktjyc.js" as="script"><link rel="prefetch" href="/assets/ToolCard-BAWKTpUw.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container no-sidebar external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/" aria-label="带我回家"><img class="vp-nav-logo" src="/logo.png" alt><!----><span class="vp-site-name hide-in-pad">Godot新手村</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="首页"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:house" sizing="height" height="1em"></iconify-icon><!--]-->首页<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="教程"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:book" sizing="height" height="1em"></iconify-icon>教程<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/tutorial/" aria-label="教程列表"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:list" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->教程列表<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/tutorial/luoye.html" aria-label="落叶轻羽B站教程"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:video" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->落叶轻羽B站教程<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/tutorial/otherbilibili.html" aria-label="其他B站UP主视频列表"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:video" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->其他B站UP主视频列表<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/tutorial/assetweb.html" aria-label="收集的资源网站"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:compass" sizing="both" width="1em" height="1em"></iconify-icon><!--]-->收集的资源网站<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/discussion/list.html" aria-label="论坛"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:comment" sizing="height" height="1em"></iconify-icon><!--]-->论坛<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/farm/" aria-label="填坑农场"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:seedling" sizing="height" height="1em"></iconify-icon><!--]-->填坑农场<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/projects/" aria-label="项目跟踪"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:list" sizing="height" height="1em"></iconify-icon><!--]-->项目跟踪<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/gamejam/" aria-label="GameJam"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:gamepad" sizing="height" height="1em"></iconify-icon><!--]-->GameJam<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/tools/" aria-label="在线工具"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:toolbox" sizing="height" height="1em"></iconify-icon><!--]-->在线工具<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/alpha/" aria-label="Alpha Agent"><!--[--><iconify-icon class="vp-icon" icon="fa6-solid:robot" sizing="height" height="1em"></iconify-icon><!--]-->Alpha Agent<!----></a></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/godotvillage/godotvillage.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><!----><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->瓦片地图详解</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">Goodman</span><span class="page-author-item">陌上竹</span></span><span property="author" content="Goodman, 陌上竹"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2025/10/23</span><meta property="datePublished" content="2025-10-23T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 25 分钟</span><meta property="timeRequired" content="PT25M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color6 clickable" role="navigation">教程</span><!--]--><meta property="articleSection" content="教程"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color6 clickable" role="navigation">瓦片地图</span><!--]--><meta property="keywords" content="瓦片地图"></span></div><hr></div><!----><div class="" vp-content><!----><div id="markdown-content"><h2 id="简介" tabindex="-1"><a class="header-anchor" href="#简介"><span>简介</span></a></h2><p>图块地图（Tile Map）是Godot中功能强大的2d地图制作节点，由于TileMap在Godot4.5已废弃，且与TileMapLayer使用其实差异不大，故本篇主要讲解 TileMapLayer。本篇为快速教程，指在方便用户快速上手TileMapLayer。</p><div class="hint-container info"><p class="hint-container-title">相关信息</p><p>在Godot 4.3之后的版本添加了<code>TilemapLayer</code>替代原有的<code>Tilemap</code>节点，使每层瓦片地图都可以使用不同的<code>tileset</code>以及物理数据等，解决了之前版本中<code>Tilemap</code>在某些复杂场景下的局限性。</p><p>在本教程中，如果没有特殊说明，以下知识默认均使用<code>TilemapLayer</code>讲解。<code>Tilemap</code>与<code>TilemapLayer</code>除了API有部分区别外，其余部分均可通用。</p></div><h2 id="基本概念" tabindex="-1"><a class="header-anchor" href="#基本概念"><span>基本概念</span></a></h2><ul><li><strong>瓦片地图（Tilemap）</strong>: 就像是一张巨大的拼图画板，你可以在上面摆放各种瓦片来构建游戏世界。比如制作一个RPG游戏的地图，草地、道路、房屋都摆放在这个画板上。</li><li><strong>瓦片地图层（TilemapLayer）</strong>: 就像Photoshop中的图层概念，每一层都是独立的画布。比如制作游戏场景时，你可以把地面放在底层，装饰物放在中层，云朵放在顶层，这样方便管理和修改。多个TilemapLayer可以堆叠使用，实现前景、中景、背景的分层效果。</li><li><strong>瓦片集合（TileSet）</strong>: 相当于你的素材库或工具箱，里面装着所有可以使用的瓦片资源。就像乐高玩具盒，里面有各种形状、颜色的积木供你选择。</li><li><strong>图集（AtlasSource）</strong>: 一张大图片，上面整齐排列着许多小瓦片素材。就像一本贴纸册，把所有地形素材（草地、石头、水面等）都印在一张大纸上，使用时按坐标裁剪。</li><li><strong>场景集合（Scene Collection）</strong>: 预先制作好的场景模板集合。比如一棵完整的树（包含树干、树冠、阴影等多个节点），可以直接作为瓦片重复使用。</li><li><strong>瓦片（Tile）</strong>: TileMap中的最小单位，就像拼图中的一小块。每个瓦片可以是一块草地、一块砖墙，或者一个装饰物。</li><li><strong>瓦片数据（Tile Data）</strong>: 每个瓦片携带的详细信息，包括它的图片位置、是否有碰撞、能否行走等。就像产品说明书，记录着这块瓦片的所有属性。<br><img src="/assets/images/tutorial/tilemap/tilemap_classes.png" alt="Tilemap相关类关系图" loading="lazy"></li></ul><h3 id="代码常用api" tabindex="-1"><a class="header-anchor" href="#代码常用api"><span>代码常用API</span></a></h3><h4 id="tilemaplayer" tabindex="-1"><a class="header-anchor" href="#tilemaplayer"><span>TilemapLayer</span></a></h4><p>对于TilemapLayer节点，有以下属性及方法可以方便的获取或设置数据。</p><ul><li>属性 <ul><li>tileset: TileSet<br> 获得TilemapLayer设置的tileset</li></ul></li><li>方法 <ul><li><code>TileData get_cell_tile_data(coords: Vector2i)</code><br> 用于获取某个坐标瓦片的瓦片数据tile_data，大部分的功能都要围绕这个API展开</li><li><code>void _tile_data_runtime_update(coords: Vector2i, tile_data: TileData)</code><br> 虚函数，重写可在游戏中修改tile的tile_data</li><li><code>bool _use_tile_data_runtime_update(coords: Vector2i)</code><br> 虚函数，重写可用于激活在游戏中修改tile_data</li><li><code>Vector2i get_neighbor_cell(coords: Vector2i, neighbor: CellNeighbor)</code><br> 用于获取某个坐标的瓦片的相邻瓦片，对于某些异形地图处理瓦片遍历很有用</li><li><code>Array[Vector2i] get_used_cells()</code><br> 获取地图中所有瓦片的坐标</li><li><code>Rect2i get_used_rect()</code><br> 获取地图所有包围瓦片的包围矩形</li><li><code>Vector2 map_to_local(map_position: Vector2i)</code><br> 从地图坐标转换为本地坐标，配合local_to_map可以快速的坐标转换操作</li><li><code>Vector2i local_to_map(local_position: Vector2)</code><br> 从本地坐标转换为地图坐标，配合map_to_local可以快速的坐标转换操作</li><li><code>void set_cell(coords: Vector2i, source_id: int = -1, atlas_coords: Vector2i = Vector2i(-1, -1), alternative_tile: int = 0)</code><br> 在对应的坐标设置对应的瓦片，自动生成地图需要大量的使用本API，source_id和atlas_coords应从tile_set中获取</li><li><code>void set_cells_terrain_connect(cells: Array[Vector2i], terrain_set: int, terrain: int, ignore_empty_terrains: bool = true)</code><br> 更新cells中所有的瓦片为terrain_set中的terrain地形。并按照规则连接地形</li></ul></li></ul><h4 id="tileset" tabindex="-1"><a class="header-anchor" href="#tileset"><span>TileSet</span></a></h4><p>对于瓦片集，虽然这个对象很重要，但是在正常使用下，几乎不需要考虑其中的API。维护tileset的工作一般在引擎中进行。<br> 如果你需要自己开发有关Tileset的插件，则需要使用它的函数。请自行在<a href="https://docs.godotengine.org/zh-cn/4.x/classes/class_tileset.html#class-tileset" target="_blank" rel="noopener noreferrer">官方文档-TileSet</a>中查阅。</p><ul><li>属性 <ul><li>tile_size: Vector2i 用于设置瓦片的大小</li></ul></li><li>方法<br> 如上，不再介绍</li></ul><h4 id="tiledata" tabindex="-1"><a class="header-anchor" href="#tiledata"><span>TileData</span></a></h4><p>瓦片信息中存储着瓦片的数据，默认情况下，某一个tile在tilemapLayer中不管使用多少次，仍使用的是同一个tile_data。如果修改这个tile_data会影响到所有的这个瓦片。如果需要单独修改某个瓦片，应使用<code>_tile_data_runtime_update</code>和<code>_use_tile_data_runtime_update</code>做特殊处理。</p><p>瓦片数据涉及的属性和方法基本都是插件才需要用到的。以下仅展示比较重要的部分。</p><p>可以判断瓦片地图是否为空来判断瓦片地图的某个位置是否有瓦片</p><ul><li>属性 <ul><li>material: Material<br> 材质，可以设置shader等</li><li>modulate: Color<br> 叠加的颜色调制</li></ul></li><li>方法 <ul><li><code>Variant get_custom_data(layer_name: String)</code><br> 获取自定义数据</li><li><code>void set_custom_data(layer_name: String, value: Variant)</code><br> 设置自定义数据</li></ul></li></ul><h2 id="使用瓦片地图" tabindex="-1"><a class="header-anchor" href="#使用瓦片地图"><span>使用瓦片地图</span></a></h2><p>下面我们将从几方面分别讲解如何使用瓦片地图</p><h3 id="构建地图" tabindex="-1"><a class="header-anchor" href="#构建地图"><span>构建地图</span></a></h3><p>1.创建TileMaplayer节点（可根据需求添加多个TileMapLayer节点）<br><img src="/assets/images/tutorial/tilemap/add-tilemap-node.png" alt="步骤一" style="width:50%;" loading="lazy"><br> 2.创建的一个新的TileSet（在TileMap节点的检查器中），然后选中某一个瓦片地图，即可在下方看到TileSet面板和TileMap面板，其中TileSet面板是用来设置TileSet中的数据的，而TileMap面板则是选取Tile并在场景中绘制的。选中TileSet面板，并在图块源中拖入一个图集图片，会弹出一个弹框询问是否按照TileSet设置的大小自动生成瓦片，可以选择同意。如果不自动生成，可以在设置中点选暗色的瓦片激活。生成的瓦片才可以绘制到Tilemap中。</p><div class="hint-container info"><p class="hint-container-title">相关信息</p><p>鼠标点击可以创建一个瓦片。<br> 按住ctrl并鼠标拖动可以快速创建多个瓦片。<br> 按住shift并鼠标拖动可以快速创建一个更大的瓦片。</p></div><p><img src="/assets/images/tutorial/tilemap/tilesetpanel.png" alt="步骤二" style="width:50%;" loading="lazy"><br> 3.选择TileMap面板，然后选中一个瓦片，确保当前是选择工具而非移动工具，然后在页面中开始绘制。默认情况下鼠标左键绘制，右键删除。<br><img src="/assets/images/tutorial/tilemap/tilemap-panel.png" alt="输入图片说明" style="width:50%;" loading="lazy"></p><h3 id="地形" tabindex="-1"><a class="header-anchor" href="#地形"><span>地形</span></a></h3><p>地形系统就像是给瓦片贴上标签，将具有相同属性的瓦片（比如都是草地、都是水域）归类为同一种地形。设置地形后，当你绘制地图时，这些瓦片会自动连接和匹配，不需要手动一个个调整边缘，大大提高了绘制效率。比如制作一片草地时，只需要选中草地地形工具涂抹，系统就会自动帮你选择合适的草地瓦片并处理好边界过渡。</p><h4 id="自动地形设置方法" tabindex="-1"><a class="header-anchor" href="#自动地形设置方法"><span>自动地形设置方法</span></a></h4><p>1.打开TileMapLayer的检查器，在TileSet的地形设置（TerrainSets）添加一个地形集，然后再添加一个地形，注意设置Mode为Match Corners（不同的匹配模式适合不同的纹理集，此处使用匹配角举例），同一个地形集使用的是同一种匹配模式。<br><img src="/assets/images/tutorial/tilemap/terrainset.png" alt="输入图片说明" style="width:50%;" loading="lazy"><br> 2.在TileSet中，选择绘制属性/地形/选择创建好的地形，在素材中进行绘制</p><div class="hint-container info"><p class="hint-container-title">相关信息</p><p><strong>绘制</strong>面板可以同时设置多个瓦片的属性，<strong>选择</strong>面板只可以设置单个瓦片的属性。</p></div><p><img src="/assets/images/tutorial/tilemap/tileset-draw-terrain.png" alt="输入图片说明" style="width:50%;" loading="lazy"><br> 3.回到TileMap面板中，选择地形，然后在场景中使用画笔进行绘制，此时可以发现，图块已经可以链接到一起了。<br><img src="/assets/images/tutorial/tilemap/use-tileset-terrain.png" alt="输入图片说明" style="width:50%;" loading="lazy"></p><h4 id="地形原理" tabindex="-1"><a class="header-anchor" href="#地形原理"><span>地形原理</span></a></h4><p>地形系统的核心工作原理可以理解为&quot;智能拼图识别&quot;。每个瓦片都携带了一张&quot;身份卡&quot;（地形位掩码），记录着它四周（上下左右及四个角）分别连接着什么类型的地形。</p><p>当你在地图上绘制时，系统会实时检查当前瓦片周围的地形情况，就像拼图时会看相邻的拼图片边缘是否匹配一样。比如一个草地瓦片，它的上方是草地、右侧是水域，系统就会自动选择一个&quot;上边是草地、右边是水域&quot;的边界瓦片来放置，保证地形的自然过渡。</p><p><strong>匹配模式</strong>决定了系统如何判断&quot;匹配&quot;：</p><ul><li><p><strong>Match Corners（匹配角）</strong>：主要关注四个角的连接情况，适合45度角的纹理或需要精确角点过渡的场景<br><img src="/assets/images/tutorial/tilemap/match_corner_example.png" alt="匹配角示例" style="width:50%;" loading="lazy"></p></li><li><p><strong>Match Sides（匹配边）</strong>：主要关注上下左右四条边的连接，适合简单的矩形瓦片<br><img src="/assets/images/tutorial/tilemap/match_sides_example.png" alt="匹配角示例" style="width:50%;" loading="lazy"></p></li><li><p><strong>Match Corners and Sides（匹配角和边）</strong>：同时考虑角和边，提供最精确的匹配，适合复杂的地形纹理<br><img src="/assets/images/tutorial/tilemap/match_corner_and_sides_example.png" alt="匹配边和角示例" style="width:50%;" loading="lazy"><br><img src="/assets/images/tutorial/tilemap/match_corner_and_sides.png" alt="匹配边和角" style="width:50%;" loading="lazy"></p></li></ul><p>由上面的示例中可以发现，匹配边和角可以展示出最复杂的地形，其缺点就是对美术要求较高。具体使用哪种地形可以根据已有的图集情况选择。</p><p>通过这种自动匹配机制，你只需要像涂色一样大面积绘制，系统就能智能地为你选择正确的边界瓦片，避免了手动拼接的繁琐工作。</p><h3 id="物理" tabindex="-1"><a class="header-anchor" href="#物理"><span>物理</span></a></h3><p>物理系统就像是给瓦片地图添加&quot;无形的墙&quot;和&quot;禁区标识&quot;。在游戏中，玩家不能穿墙而过，角色不能掉出地图边界，这些都需要通过物理碰撞来实现。TileMap的物理系统让你可以直接在瓦片上绘制碰撞形状，比如给墙壁、岩石、地图边界等瓦片设置碰撞体，角色在移动时就会自动被这些&quot;无形的墙&quot;阻挡。这样你就不需要手动创建大量的碰撞体节点，大大简化了场景搭建的工作。</p><p>首先需要在tileset中添加一个物理层。并设置物理层和物理遮罩层。需要的话也可以设置物理材质。<br><img src="/assets/images/tutorial/tilemap/tilemap_physics_layer.png" alt="物理层" loading="lazy"><br> 然后在TileSet面板中切换到绘制面板，选择刚才新建的物理层，在下方添加形状后点击瓦片开始绘制。物理形状可以有多个。尽量不要重叠。<br><img src="/assets/images/tutorial/tilemap/tilemap_physics_draw.png" alt="绘制物理形状" loading="lazy"></p><div class="hint-container warning"><p class="hint-container-title">注意</p><p>物理绘制必须像素对齐。否则可能会导致玩家在场景中移动时卡在某个位置无法移动。<br> 可以点开绘制旁边的<strong>栅格吸附</strong>。选择<strong>半像素吸附</strong>或<strong>栅格吸附</strong>(推荐)，即可获得更加准确的定位。</p></div><p>以下是一个绘制地图边界的示例<br><img src="/assets/images/tutorial/tilemap/tilemap_physics.png" alt="物理示例" style="width:50%;" loading="lazy"><br> 以下是一个绘制不可穿过的地形的示例<br><img src="/assets/images/tutorial/tilemap/tilemap_physics2.png" alt="物理示例2" style="width:50%;" loading="lazy"></p><p>在绘制时，还可以为形状设置不同的属性，例如是否单向碰撞等。</p><h3 id="导航" tabindex="-1"><a class="header-anchor" href="#导航"><span>导航</span></a></h3><p>2D导航可以参照教程<a href="/tutorial/navigation">导航系统以及A星算法</a>，接下来介绍使用TilemapLayer构建导航区域。<br><img src="/assets/images/tutorial/tilemap/tilemap_physics_draw.png" alt="导航层" loading="lazy"></p><p>创建导航层之后，即可像是物理那样在绘制中绘制导航层形状。<br><img src="/assets/images/tutorial/tilemap/tilemap_navigation_example.png" alt="导航示例" style="width:50%;" loading="lazy"></p><p>绘制导航层后，即可像使用NavigationRegion2D那样开始使用2D导航了。</p><div class="hint-container warning"><p class="hint-container-title">注意</p><p>需要注意的是，由于Tilemap的导航层不可以烘焙，所以无法使用根据StaticBody来动态的烘焙导航区域。请根据需求自行选择方案。</p><p>此处提供另一种方案，即为TilemapLayer添加分组，并使NavigationRegion2D根据分组烘焙导航区域。<br><img src="/assets/images/tutorial/tilemap/tilemap_bake_navation_region.png" alt="烘焙导航区域" style="width:50%;" loading="lazy"></p></div><h3 id="光照" tabindex="-1"><a class="header-anchor" href="#光照"><span>光照</span></a></h3><p>光照系统就像是给瓦片地图添加&quot;光影魔法&quot;。在游戏中，墙壁可以阻挡光线形成阴影，营造出真实的明暗效果。TileMap的光照遮挡系统让你可以直接在瓦片上绘制遮挡形状，就像使用LightOccluder2D节点一样，为游戏场景添加丰富的光影效果，增强视觉层次感。</p><p>首先需要在TileSet的Rendering（渲染）设置中找到Occlusion Layers（遮挡层），新建一个遮挡层。</p><p>然后在TileSet面板中切换到绘制面板，选择刚才新建的遮挡层，在下方添加遮挡形状后点击瓦片开始绘制。遮挡形状定义了哪些区域会阻挡光线，从而产生阴影效果。</p><p>绘制完成后，场景中的Light2D节点就会根据这些遮挡形状自动计算阴影，就像使用LightOccluder2D节点一样。你可以为不同的瓦片设置不同的遮挡形状，比如墙壁需要完全遮挡光线，而栅栏可能只需要部分遮挡。</p><div class="hint-container info"><p class="hint-container-title">相关信息</p><p>遮挡层的使用方式与LightOccluder2D完全相同，如果你熟悉LightOccluder2D的使用方法，那么在TileMap中使用遮挡层会非常容易上手。<br> 如果绘制完成后发现没有出现遮挡，需要开启光线节点的<code>shadow_enable</code>属性</p></div><p><img src="/assets/images/tutorial/tilemap/tileset-light.png" alt="光照示例" style="width:50%;" loading="lazy"></p><h3 id="y排序" tabindex="-1"><a class="header-anchor" href="#y排序"><span>Y排序</span></a></h3><p>在使用瓦片地图时，往往会出现瓦片大小超出网格的情况，此时需要离相机更近的瓦片盖住离相机更远的瓦片，因为是2D环境下，所以通常会使用瓦片所在的Y坐标作为渲染前后的依据，即：Y坐标更大的瓦片会盖住Y坐标更小的瓦片。</p><p>Godot中开启Y坐标排序的方法很简单，只需要在节点上勾选<code>Ordering</code>中的<code>Y Sort Enabled</code>即可。开启选项之后，会将这个节点的<strong>所有子节点</strong>按照Y坐标大小排序。</p><p>我们继续使用案例来讲解，这是一个没有开启Y排序的地图，可以看到，虽然所有图块都在同一层，但是出现了莫名奇妙的重叠现象。</p><p><img src="/assets/images/tutorial/tilemap/tileset_with_no_ysort.png" alt="关闭Y排序示例" style="width:50%;" loading="lazy"></p><p>而打开Y排序后，无需任何其他操作，Y坐标更大的下方的瓦片就会自然的盖住上方的瓦片。<br><img src="/assets/images/tutorial/tilemap/tileset_with_ysort.png" alt="开启Y排序示例" style="width:50%;" loading="lazy"></p><h3 id="场景合集" tabindex="-1"><a class="header-anchor" href="#场景合集"><span>场景合集</span></a></h3><p>瓦片图集通常可以满足大部分的需求，但有时我们会遇到更复杂的场景。<br> 类似希望能将一个Area2D像瓦片那样可以在网格上放置。此时我们就需要场景合集功能。</p><p>首先在TileSet面板中点击下方的加号<br> 然后选择场景合集，然后上方即可出现一个场景合集，选中它之后，即可看到一个空的场景合集。</p><p><img src="/assets/images/tutorial/tilemap/tilemap_scene_collection.png" alt="场景合集" style="width:50%;" loading="lazy"></p><p>然后将需要作为场景合集的场景拖入到场景合集中，然后切换到TileMap面板，即可像正常绘制的瓦片那样绘制场景。</p><p><img src="/assets/images/tutorial/tilemap/tilemap_add_scene.png" alt="使用场景合集" style="width:50%;" loading="lazy"></p><h2 id="具体案例" tabindex="-1"><a class="header-anchor" href="#具体案例"><span>具体案例</span></a></h2><h3 id="案例1-防止相机移出地图范围" tabindex="-1"><a class="header-anchor" href="#案例1-防止相机移出地图范围"><span>案例1：防止相机移出地图范围</span></a></h3><p>​基于地图信息的游戏逻辑：利用获取到的地图信息来决定游戏行为。一个典型的应用是<strong>设置相机边界</strong>，防止相机移出地图范围</p><p>1.添加TileMapLayer节点和玩家相机节点<br> 2.设置相机边界逻辑</p><p>完整代码如下：</p><div class="language-gdscript line-numbers-mode" data-highlighter="shiki" data-ext="gdscript" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-gdscript"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 1. 添加TileMapLayer节点和玩家相机节点</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">@onready</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> camera_2d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Camera2D</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> $</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">player/Camera2D</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">@export</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tile_map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">TileMapLayer</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 2. 设置相机边界逻辑</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> _ready</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-&gt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> void</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	# 获取TileMap节点中所有已被放置图块所占据的矩形区域</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	# grow(-1)为缩进一格 为避免在相机视口内露出地图边缘</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> used</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tile_map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get_used_rect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grow</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	# 获取 TileMap 一个图块的尺寸</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tile_size</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> :=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tile_map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tile_set</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tile_size</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	# 根据TileMap地块尺寸 限制相机的移动</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	# 将网格坐标表示的边界转换为像素坐标表示的边界</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	# 2d相机的最高/低点</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	camera_2d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">limit_top</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> used</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">position</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">y</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tile_size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">y</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	camera_2d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">limit_bottom</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> used</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">end</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">y</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tile_size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">y</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	# 2d相机的最左/右点</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	camera_2d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">limit_left</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> used</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">position</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">x</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tile_size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">x</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	camera_2d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">limit_right</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> used</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">end</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">x</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tile_size</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">x</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	# 重置相机的平滑过渡，防止玩家初始位置在限制区域外时产生镜头抖动</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	camera_2d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">reset_smoothing</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="案例2-鼠标点击添加图块" tabindex="-1"><a class="header-anchor" href="#案例2-鼠标点击添加图块"><span>案例2：鼠标点击添加图块</span></a></h3><p>通过获取TileMap的瓦片位置坐标来修改地图效果，制作出游戏中实时添加地图图块的效果</p><p>1.添加需要修改的TileMapLayer节点引用<br> 2.在func _input()中设置好输入映射（鼠标点击动作），获取鼠标点击位置，再转换为瓦片位置<br> 3.定位要添加的瓦片素材坐标位置（图片ID+图集坐标）<br> 4.使用set_cell函数将瓦片在运行时添加到TileMap中<br> 5.拓展：添加鼠标右击清除图块的效果</p><p>完整代码如下：</p><div class="language-gdscript line-numbers-mode" data-highlighter="shiki" data-ext="gdscript" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-gdscript"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 1. 添加TileMapLayer节点引用</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">@onready</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tile_map_layer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">TileMapLayer</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> $</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">TileMapLayer</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 2. TileSet中图片素材的id</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> source_id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> : </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># TileSet中图片素材的坐标位置</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> atlas_coord</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> : </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Vector2i</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Vector2i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> _input</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">event</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	# 当鼠标左键点击，执行以下操作</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	if</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Input</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">is_action_just_pressed</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;click&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		# 获取鼠标点击的全局位置</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mouse_pos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> : </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Vector2</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> get_global_mouse_position</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		# 转换鼠标全局为瓦片位置</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tile_mosuse_pos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> : </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Vector2i</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tile_map_layer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">local_to_map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">mouse_pos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		# 使用set_cell将瓦片添加到TileMap中</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">		tile_map_layer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set_cell</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tile_mosuse_pos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> , </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">source_id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> , </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">atlas_coord</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	# 拓展：鼠标右击清除图块</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	if</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Input</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">is_action_just_pressed</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;right_click&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mouse_pos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> : </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Vector2</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> get_global_mouse_position</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tile_mosuse_pos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> : </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Vector2i</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tile_map_layer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">local_to_map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">mouse_pos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		# 将source_id设置为-1即可清除瓦片</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">		tile_map_layer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set_cell</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tile_mosuse_pos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> , </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> , </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">atlas_coord</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意<br> 1.为确保类型安全可以在var 声明这个变量的类型<br> 2.tile_mosuse_posw瓦片位置变量类型为Vector2i区别于Vector2，所以需要转化</p><h3 id="案例3-动态切换瓦片数据实现隐藏地图效果" tabindex="-1"><a class="header-anchor" href="#案例3-动态切换瓦片数据实现隐藏地图效果"><span>案例3：动态切换瓦片数据实现隐藏地图效果</span></a></h3><p>接下来我们创建一个游戏，然后创建三层瓦片地图，一层是背景，一层是无法穿过的墙，一层是当达到条件是就会消失的墙。<br> 并添加一个玩家，这里代码比较简单且无关，不再赘述。场景节点如下。Area2D盖住的部分就是会消失的墙。</p><p><img src="/assets/images/tutorial/tilemap/example3-1.png" alt="使用场景合集" style="width:50%;" loading="lazy"></p><p>目前由于物理形状的存在，所以所有的墙都不能穿过。接下来，我们要为MaskLayer添加一个脚本，当Area2D检测到玩家时，就将瓦片的物理关闭，并且透明度变成0.3。展示出内部的山洞并且允许玩家进入。</p><div class="language-gdscript line-numbers-mode" data-highlighter="shiki" data-ext="gdscript" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-gdscript"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">## mask_layer.gd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">extends</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> TileMapLayer</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 记录玩家是否进入</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> player_entered</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">bool</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> false</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> _on_area_2d_body_entered</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">_body</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Node2D</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-&gt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> void</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	player_entered</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">	notify_runtime_tile_data_update</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> _on_area_2d_body_exited</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">_body</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Node2D</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-&gt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> void</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	player_entered</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> false</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">	notify_runtime_tile_data_update</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 是否更新瓦片信息</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> _use_tile_data_runtime_update</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">_coords</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Vector2i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-&gt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> bool</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	# 因为玩家离开后会慢慢恢复不透明，所以所有的瓦片都需要更新</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 隐藏层的透明度</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> layer_alpha</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1.0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 更新瓦片数据</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> _tile_data_runtime_update</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">_coords</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Vector2i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">tile_data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">TileData</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-&gt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> void</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> player_entered</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">		tile_data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set_collision_polygons_count</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 根据玩家进入状态修改透明度</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> _process</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">delta</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">float</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-&gt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> void</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> player_entered</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> layer_alpha</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0.3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">			layer_alpha</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> move_toward</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">layer_alpha</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">delta</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">			set_modulate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Color</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">layer_alpha</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	else</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> layer_alpha</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1.0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">			layer_alpha</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> move_toward</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">layer_alpha</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1.0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">delta</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">			set_modulate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Color</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">layer_alpha</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><video src="/assets/images/tutorial/tilemap/example3-2.mp4" controls style="width:100%;"></video></p><p><strong>代码实现要点：</strong></p><p>这个案例的核心思路是让地图&quot;活起来&quot;——当玩家靠近时，墙壁会变得透明并允许穿过，就像游戏中的&quot;透视墙&quot;或&quot;隐藏通道&quot;效果。实现的关键步骤如下：</p><ol><li><p><strong>玩家检测</strong>：就像在门口安装感应器一样，当玩家进入<code>Area2D</code>区域时，系统会收到信号，然后通知所有瓦片&quot;该更新了！&quot;。这里使用<code>notify_runtime_tile_data_update()</code>来触发更新。</p></li><li><p><strong>移除碰撞</strong>：当玩家进入区域后，原本阻挡玩家的墙壁需要&quot;消失&quot;。通过重写<code>_tile_data_runtime_update()</code>函数，把瓦片的碰撞形状清空（设置为0），这样玩家就可以自由穿过了。就像原本坚硬的墙壁突然变成了空气。</p></li><li><p><strong>透明度动画</strong>：为了让效果更自然，使用<code>move_toward()</code>让透明度平滑过渡。玩家靠近时，墙壁慢慢变透明（降到0.3），让玩家能隐约看到后面的内容；玩家离开时，墙壁又慢慢恢复不透明，营造出神秘感。</p></li><li><p><strong>同步更新</strong>：通过让<code>_use_tile_data_runtime_update()</code>返回<code>true</code>，确保整个图层的所有瓦片都能实时响应状态变化，而不是只有个别瓦片在更新。</p></li></ol><p>这种动态修改瓦片数据的技术非常实用，你可以用它制作探索类的隐藏区域、根据剧情触发的地形变化，或者像传送门那样可穿透的特殊墙壁效果。</p><p>示例项目代码下载 <a href="/zips/tilemap-example.zip">项目文件</a></p><h3 id="案例4-六边形寻路" tabindex="-1"><a class="header-anchor" href="#案例4-六边形寻路"><span>案例4：六边形寻路</span></a></h3><p>在策略类游戏中，我们经常需要实现类似&quot;回合制移动&quot;的效果——玩家每回合只能移动固定步数，并且需要在地图上高亮显示所有可以到达的位置。这个案例将展示如何在六边形网格地图上实现这个功能。</p><p>想象一下你在玩一个战棋游戏，角色每回合有3步行动力。当你点击角色时，游戏会自动计算出所有在3步内可以到达的位置，并用不同颜色标记出来。这背后的原理就是<strong>广度优先搜索（BFS）</strong>——就像水波扩散一样，从起点开始一层一层向外探索，每一层代表一步移动。</p><p><strong>实现思路：</strong></p><ol><li><p><strong>准备六边形网格地图</strong>：首先需要创建一个使用六边形瓦片的TileMapLayer。六边形网格与方形网格不同，每个六边形有6个相邻位置，而且需要特殊的坐标转换算法来正确处理相邻关系。<br><img src="/assets/images/tutorial/tilemap/example4-1.png" alt="准备六边形网格地图" style="width:50%;" loading="lazy"></p></li><li><p><strong>获取起点和步数限制</strong>：确定玩家当前所在的六边形坐标，以及这一回合可以移动的最大步数（比如3步）。</p></li><li><p><strong>使用广度优先搜索探索</strong>：就像雷达扫描一样，从起点开始，先标记起点为&quot;可以到达&quot;，然后探索起点周围的所有邻居位置。每个探索到的位置会被标记为&quot;可以到达&quot;，并且记录它是从哪个位置到达的（就像在地图上做标记&quot;我从这里来&quot;）。接着继续探索这些邻居位置的邻居，一层一层向外扩散，直到达到步数限制。</p></li><li><p><strong>记录路径信息</strong>：在搜索过程中，我们需要用一个字典（Dictionary）来记录每个可到达位置的前一个位置。这样当玩家选择移动目标时，我们就能反向追踪路径，知道要经过哪些位置才能到达目的地。<br><img src="/assets/images/tutorial/tilemap/example4-2.png" alt="使用广度优先搜索探索并记录路径信息" style="width:50%;" loading="lazy"></p></li><li><p><strong>高亮显示可到达区域</strong>：搜索完成后，所有在步数限制内可以到达的位置都会被标记出来。你可以通过修改这些位置的瓦片颜色、添加高亮效果，或者绘制特殊标记来让玩家清楚地看到移动范围。</p></li><li><p><strong>处理障碍物</strong>：在搜索过程中，如果遇到障碍物（比如墙壁、其他角色占据的位置），就要跳过这个位置，不继续从这个位置向外探索。就像实际走路遇到墙，你不可能穿墙而过。</p></li><li><p><strong>鼠标点击检测与路径获取</strong>：当玩家点击地图上的某个位置时，需要将鼠标的屏幕坐标转换为六边形网格坐标。使用<code>local_to_map()</code>函数可以将鼠标点击的位置转换为对应的瓦片坐标。然后检查这个位置是否在之前搜索到的&quot;可到达位置&quot;列表中。如果这个位置是可以到达的，就可以开始获取移动路径了。</p></li><li><p><strong>反向追踪路径</strong>：由于我们在搜索时记录了每个位置的&quot;前一个位置&quot;，现在可以从目标位置开始，沿着&quot;前一个位置&quot;一直往回追溯，直到回到起点。这个过程就像沿着标记一路走回起点，最终得到一条从起点到目标的完整路径。注意，由于是从目标往回追溯，得到的路径是反序的，需要反转一下才能得到从起点到目标的正确顺序。<br><img src="/assets/images/tutorial/tilemap/example4-3.png" alt="鼠标点击检测与路径获取和反向计算路径" style="width:50%;" loading="lazy"></p></li><li><p><strong>使用Tween平滑移动</strong>：得到路径后，使用Godot的Tween节点或Tween类来实现平滑的移动动画。就像让角色沿着路径&quot;滑行&quot;过去，而不是瞬间传送。对于路径上的每个位置，使用<code>map_to_local()</code>将网格坐标转换为世界坐标，然后让Tween将玩家的位置从当前位置平滑过渡到下一个位置。每到达一个位置后，继续移动到下一个位置，直到到达目标。这样玩家就能看到角色一步一步沿着规划好的路径移动，而不是直接跳过去。<br><img src="/assets/images/tutorial/tilemap/example4-4.png" alt="鼠标点击检测与路径获取和反向计算路径" style="width:50%;" loading="lazy"></p></li></ol><details class="hint-container details"><summary>代码</summary><div class="language-gdscript line-numbers-mode" data-highlighter="shiki" data-ext="gdscript" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-gdscript"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">extends</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Node2D</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 1、准备六边形网格地图和玩家</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">@onready</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tile_map_layer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">TileMapLayer</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> $</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">TileMapLayer</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">@onready</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> player</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Node2D</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> $</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">Player</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">@onready</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> marked_layer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">TileMapLayer</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> $</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">MarkedLayer</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 2、获取起点和步数限制</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> init_position</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Vector2i</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Vector2i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> step_limit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">int</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> path_info</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Dictionary</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {} </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 记录路径信息</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> _ready</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-&gt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> void</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	# 将玩家起点位置</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	player</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">global_position</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tile_map_layer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">map_to_local</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">init_position</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">	search_and_show_path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">init_position</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 搜索并展示</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> search_and_show_path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">start_position</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Vector2i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">	search_path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">start_position</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">	print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;当前位置可以移动到的坐标: &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">path_info</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">	highlight_cells</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 3、使用广度优先搜索探索</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 4、记录路径信息</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> search_path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">start_position</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Vector2i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-&gt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> void</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	# 清空路径信息</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	path_info</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {}</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	# 记录路径信息</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	path_info</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">start_position</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">		&quot;front_point&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">		&quot;step&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	# 记录已访问位置</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> visited</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Dictionary</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	visited</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">start_position</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	# 记录待探索位置</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> queue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Array</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Vector2i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">start_position</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	while</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> not </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">queue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">is_empty</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> current_position</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Vector2i</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> queue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pop_front</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> path_info</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">current_position</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">][</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;step&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> step_limit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">			continue</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> surrounding_cells</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Array</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Vector2i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tile_map_layer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get_surrounding_cells</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">current_position</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		for</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> cell</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> in</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> surrounding_cells</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">			# 如果cell没有tile_data，则跳过</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">			if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tile_map_layer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get_cell_tile_data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cell</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">				continue</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">			# 如果cell已经访问过，则跳过</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">			if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> not </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">visited</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">has</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cell</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">				visited</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cell</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">				# 记录待探索位置</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">				queue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">append</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cell</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">				# 记录路径信息</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">				path_info</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cell</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">					&quot;front_point&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">current_position</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">					&quot;step&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">path_info</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">current_position</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">][</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;step&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">				}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> marked_cell_source_id</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> marked_cell_coord</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Vector2i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 5、高亮可以移动到的坐标</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> highlight_cells</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	# 清空标记层</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	marked_layer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">clear</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	for</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> cell_coord</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> in</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> path_info</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">keys</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		# 设置标记层</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">		marked_layer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">set_cell</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">cell_coord</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">marked_cell_source_id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">marked_cell_coord</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> _input</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">event</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">InputEvent</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-&gt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> void</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	# 7、当玩家鼠标点击时获取坐标并处理</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> event</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> is</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> InputEventMouseButton</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> and </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">event</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">button_index</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> ==</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> MOUSE_BUTTON_LEFT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> and </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">event</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">pressed</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> mouse_pos</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> get_global_mouse_position</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> map_coord</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tile_map_layer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">local_to_map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tile_map_layer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">to_local</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">mouse_pos</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">		print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">map_coord</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">		# 判断是否可以移动到对应位置</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tile_map_layer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">get_cell_tile_data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">map_coord</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> and </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">path_info</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">has</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">map_coord</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">			# 8、反向获得路径</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">			var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Array</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Vector2i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> []</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">			var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> current</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Vector2i</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> map_coord</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">			while</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> path_info</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">has</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">current</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">):</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">				# 将路径点添加到路径数组前方</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">				path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push_front</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">current</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">				var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> front_point</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> path_info</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">current</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">][</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;front_point&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">				if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> front_point</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> ==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">					break</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">				current</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> front_point</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">			print</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;移动路径: &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">			# 移动玩家到目标位置</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">			await</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> move_player_along_path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">			# 更新起点并重新搜索路径</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">			search_and_show_path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">map_coord</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 9、让玩家沿着路径移动</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">func</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> move_player_along_path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Array</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Vector2i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-&gt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> void</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	if</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">is_empty</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		return</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	# 删除当前位置</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">	path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pop_front</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">	# 更新玩家位置到目标点</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">	while</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> not </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">is_empty</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> next_position</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Vector2i</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pop_front</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		var</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tween</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> get_tree</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">create_tween</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">		tween</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tween_property</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">player</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;global_position&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">tile_map_layer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">map_to_local</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">next_position</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">		await</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> tween</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">finished</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><p><video src="/assets/images/tutorial/tilemap/example4.mp4" controls style="width:100%;"></video></p><p><strong>关键要点：</strong></p><ul><li><p><strong>队列结构</strong>：广度优先搜索需要一个队列（Queue）来存储待探索的位置，按照&quot;先探索的先处理&quot;的原则，保证每次都是先处理距离起点更近的位置。</p></li><li><p><strong>已访问标记</strong>：为了避免重复探索同一个位置（防止绕圈子），需要记录哪些位置已经被访问过。</p></li><li><p><strong>步数计数</strong>：每个位置都要记录它距离起点多少步，只有当步数小于等于限制步数时，才继续从这个位置向外探索。</p></li><li><p><strong>路径回溯</strong>：通过记录&quot;前一个位置&quot;，当玩家点击目标位置时，可以从目标位置开始，沿着&quot;前一个位置&quot;一路回溯到起点，就能得到完整的移动路径。</p></li><li><p><strong>坐标转换</strong>：在鼠标点击和移动过程中，需要频繁进行坐标转换。<code>local_to_map()</code>将世界坐标转换为网格坐标，用于判断点击的是哪个瓦片；<code>map_to_local()</code>将网格坐标转换为世界坐标，用于设置角色的实际位置。</p></li><li><p><strong>Tween动画链</strong>：移动路径可能包含多个位置，需要让Tween依次执行。可以在每个Tween动画完成后，通过回调函数或者检查Tween的状态，触发下一个位置的移动，形成一条连贯的移动动画链。</p></li></ul><p>这种寻路方式非常适合回合制策略游戏，不仅能显示移动范围，还能在玩家选择目标后自动规划最优路径。通过Tween实现的平滑移动让游戏体验更加流畅自然。你可以在战棋游戏、RPG游戏的地图探索，或者任何需要限制移动范围的游戏中使用这个技术。</p><p>示例项目代码下载 <a href="/zips/tilemap-hexagon-example.zip">项目文件</a></p><h2 id="参考视频" tabindex="-1"><a class="header-anchor" href="#参考视频"><span>参考视频</span></a></h2><p><a href="https://www.bilibili.com/video/BV1Yz4y1b7hz" target="_blank" rel="noopener noreferrer">如何使用 TileMap｜Godot 4 教程《勇者传说》#2_哔哩哔哩_bilibili</a><br><a href="https://www.bilibili.com/video/BV17t42157si" target="_blank" rel="noopener noreferrer">Godot 4 TileMap 教程（1）设置、图层、动画_哔哩哔哩_bilibili</a></p></div><!----><!----><!----></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/godotvillage/godotvillage.github.io/edit/main/src/tutorial/tilemap.md" aria-label="在 GitHub 上编辑此页" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">最近更新</span><time class="vp-meta-info" datetime="2025-11-05T09:53:38.000Z" data-allow-mismatch>2025/11/5 09:53</time></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 925236118@qq.com">moshangzhu</span><!--]--><!--]--></div></div></footer><!----><div id="comment" class="giscus-wrapper input-top vp-comment" vp-comment style="display:block;"><div style="display: flex;align-items: center;justify-content: center;height: 96px"><span style="--loading-icon: url(&quot;data:image/svg+xml;utf8,%3Csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; preserveAspectRatio=&#39;xMidYMid&#39; viewBox=&#39;25 25 50 50&#39;%3E%3CanimateTransform attributeName=&#39;transform&#39; type=&#39;rotate&#39; dur=&#39;2s&#39; keyTimes=&#39;0;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;360&#39;%3E%3C/animateTransform%3E%3Ccircle cx=&#39;50&#39; cy=&#39;50&#39; r=&#39;20&#39; fill=&#39;none&#39; stroke=&#39;currentColor&#39; stroke-width=&#39;4&#39; stroke-linecap=&#39;round&#39;%3E%3Canimate attributeName=&#39;stroke-dasharray&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;1,200;90,200;1,200&#39;%3E%3C/animate%3E%3Canimate attributeName=&#39;stroke-dashoffset&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;-35px;-125px&#39;%3E%3C/animate%3E%3C/circle%3E%3C/svg%3E&quot;);--icon-size: 48px;display: inline-block;width: var(--icon-size);height: var(--icon-size);background-color: currentcolor;-webkit-mask-image: var(--loading-icon);mask-image: var(--loading-icon)"></span></div></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer">山高万仞，只登一步。日拱一卒，功不唐捐</div><div class="vp-copyright">Copyright © 2025 Goodman, 陌上竹 </div></footer></div><!--]--><!--[--><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/assets/app-DI3rh0pQ.js" defer></script>
  </body>
</html>
